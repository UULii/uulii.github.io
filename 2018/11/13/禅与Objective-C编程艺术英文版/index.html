<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="《禅与Objective-C编程艺术》,">










<meta name="description" content="Zen and the Art of the Objective-C Craftsmanship  Preface Swift For the Community Authors   Conditionals Yoda conditions nil and BOOL checks Golden Path Complex Conditions Ternary Operator Error handl">
<meta name="keywords" content="《禅与Objective-C编程艺术》">
<meta property="og:type" content="article">
<meta property="og:title" content="禅与Objective-C编程艺术英文版">
<meta property="og:url" content="http://yoursite.com/2018/11/13/禅与Objective-C编程艺术英文版/index.html">
<meta property="og:site_name" content="优优的饲养员">
<meta property="og:description" content="Zen and the Art of the Objective-C Craftsmanship  Preface Swift For the Community Authors   Conditionals Yoda conditions nil and BOOL checks Golden Path Complex Conditions Ternary Operator Error handl">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://yoursite.com/2018/11/13/禅与Objective-C编程艺术英文版/zen-logo-thumb.png">
<meta property="og:image" content="http://yoursite.com/2018/11/13/禅与Objective-C编程艺术英文版/yoda.png">
<meta property="og:image" content="http://yoursite.com/2018/11/13/禅与Objective-C编程艺术英文版/blocks_debugger.png">
<meta property="og:updated_time" content="2018-11-20T03:00:19.381Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="禅与Objective-C编程艺术英文版">
<meta name="twitter:description" content="Zen and the Art of the Objective-C Craftsmanship  Preface Swift For the Community Authors   Conditionals Yoda conditions nil and BOOL checks Golden Path Complex Conditions Ternary Operator Error handl">
<meta name="twitter:image" content="http://yoursite.com/2018/11/13/禅与Objective-C编程艺术英文版/zen-logo-thumb.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"always","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2018/11/13/禅与Objective-C编程艺术英文版/">





  <title>禅与Objective-C编程艺术英文版 | 优优的饲养员</title>
  








</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">优优的饲养员</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">洛阳魔方科技有限公司</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/11/13/禅与Objective-C编程艺术英文版/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="张康">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="优优的饲养员">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">禅与Objective-C编程艺术英文版</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-11-13T15:14:14+08:00">
                2018-11-13
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/books/" itemprop="url" rel="index">
                    <span itemprop="name">books</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/books/iOS/" itemprop="url" rel="index">
                    <span itemprop="name">iOS</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="Zen-and-the-Art-of-the-Objective-C-Craftsmanship"><a href="#Zen-and-the-Art-of-the-Objective-C-Craftsmanship" class="headerlink" title="Zen and the Art of the Objective-C Craftsmanship"></a>Zen and the Art of the Objective-C Craftsmanship</h1><p><img src="/2018/11/13/禅与Objective-C编程艺术英文版/zen-logo-thumb.png" alt=""></p>
<ul>
<li><a href="#preface">Preface</a><ul>
<li><a href="#swift">Swift</a></li>
<li><a href="#for-the-community">For the Community</a></li>
<li><a href="#authors">Authors</a></li>
</ul>
</li>
<li><a href="#conditionals">Conditionals</a><ul>
<li><a href="#yoda-conditions">Yoda conditions</a></li>
<li><a href="#nil-and-bool-checks">nil and BOOL checks</a></li>
<li><a href="#golden-path">Golden Path</a></li>
<li><a href="#complex-conditions">Complex Conditions</a></li>
<li><a href="#ternary-operator">Ternary Operator</a></li>
<li><a href="#error-handling">Error handling</a></li>
</ul>
</li>
<li><a href="#case-statements">Case Statements</a><ul>
<li><a href="#enumerated-types">Enumerated Types</a></li>
</ul>
</li>
<li><a href="#naming">Naming</a><ul>
<li><a href="#general-conventions">General conventions</a></li>
<li><a href="#constants">Constants</a></li>
<li><a href="#methods">Methods</a></li>
<li><a href="#literals">Literals</a></li>
</ul>
</li>
<li><a href="#class">Class</a><ul>
<li><a href="#class-name">Class name</a></li>
<li><a href="#initializer-and-dealloc">Initializer and dealloc</a><ul>
<li><a href="#designated-and-secondary-initializers">Designated and Secondary Initializers</a><ul>
<li><a href="#designated-initializer">Designated Initializer</a></li>
<li><a href="#secondary-initializer">Secondary Initializer</a><ul>
<li><a href="#references">References</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#instancetype">instancetype</a><ul>
<li><a href="#reference">Reference</a></li>
</ul>
</li>
<li><a href="#initialization-patterns">Initialization Patterns</a><ul>
<li><a href="#class-cluster">Class cluster</a></li>
<li><a href="#singleton">Singleton</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#properties">Properties</a><ul>
<li><a href="#init-and-dealloc">Init and Dealloc</a></li>
<li><a href="#dot-notation">Dot-Notation</a><ul>
<li><a href="#property-declaration">Property Declaration</a></li>
</ul>
</li>
<li><a href="#private-properties">Private Properties</a><ul>
<li><a href="#mutable-object">Mutable Object</a></li>
<li><a href="#lazy-loading">Lazy Loading</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#methods">Methods</a><ul>
<li><a href="#parameter-assert">Parameter Assert</a></li>
<li><a href="#private-methods">Private methods</a></li>
</ul>
</li>
<li><a href="#equality">Equality</a></li>
</ul>
</li>
<li><a href="#categories">Categories</a></li>
<li><a href="#protocols">Protocols</a></li>
<li><a href="#nsnotification">NSNotification</a></li>
<li><a href="#beautifying-the-code">Beautifying the code</a><ul>
<li><a href="#spacing">Spacing</a></li>
<li><a href="#line-breaks">Line Breaks</a></li>
<li><a href="#brackets">Brackets</a></li>
</ul>
</li>
<li><a href="#code-organization">Code Organization</a><ul>
<li><a href="#exploit-code-block">Exploit Code Block</a></li>
<li><a href="#pragma">Pragma</a><ul>
<li><a href="#pragma-mark">Pragma Mark</a></li>
</ul>
</li>
<li><a href="#explicit-warnings-and-errors">Explicit warnings and errors</a></li>
<li><a href="#docstrings">Docstrings</a></li>
<li><a href="#comments">Comments</a><ul>
<li><a href="#header-documentation">Header Documentation</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#inter-object-communication">Inter-Object Communication</a><ul>
<li><a href="#blocks">Blocks</a><ul>
<li><a href="#under-the-hood">Under the Hood</a></li>
<li><a href="#retain-cycles-on-self">Retain cycles on self</a></li>
</ul>
</li>
<li><a href="#delegate-and-datasource">Delegate and DataSource</a><ul>
<li><a href="#inheritance">Inheritance</a></li>
<li><a href="#multiple-delegation">Multiple Delegation</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#aspect-oriented-programming">Aspect Oriented Programming</a></li>
<li><a href="#references">References</a><ul>
<li><a href="#other-objective-c-style-guides">Other Objective-C Style Guides</a></li>
</ul>
</li>
</ul>
<h1 id="Preface"><a href="#Preface" class="headerlink" title="Preface"></a>Preface</h1><p>We started writing this book on November 2013. The initial goal was to provide guidelines to write the most clean Objective-C code possible: there are too many guidelines out there and all of them are debatable. We didn’t aim introducing hard rules but, instead, a way for writing code to be more uniform as possible across different developers.<br>With time the scope moved to explain how to design and architecture good code.</p>
<p>The idea underneath is that the code should not only compile, instead it should “validate”. Good code has several characteristics: should be concise, self-explanatory, well organized, well documented, well named, well designed and stand the test of time.<br>The main goals behind the curtain are that clarity always wins over performance and a rationale for a choice should always be provided.<br>Some topics discussed here are general and independent from the language even if everything is tied up to Objective-C.</p>
<h2 id="Swift"><a href="#Swift" class="headerlink" title="Swift"></a>Swift</h2><p>On June 6th, 2014 Apple announced the new programming language to be used for iOS and Mac development in future: Swift.<br>This new language is a radical departure from Objective-C and, of course, has caused a change in our plan for writing this book. It boiled down to the decision of releasing the current status of this essay without continuing our journey in unfolding the topics we originally planned to include.<br>Objective-C is not going anywhere but at the same time continuing to write a book on a language that will not receive the same attention as it used to, is not a wise move.</p>
<h2 id="For-the-Community"><a href="#For-the-Community" class="headerlink" title="For the Community"></a>For the Community</h2><p>We have released this book for free and for the community because we hope to provide value to the reader, if each one of you can learn at least one best practice we have reached our goal.</p>
<p>We have done our best to polish this text and make it pleasant to the reader but we may have made typos, mistakes or left any part incomplete. We strongly encourage you to give us feedback and suggest improvements, so please get in touch with us if have any. We particularly appreciate pull requests.</p>
<h2 id="Authors"><a href="#Authors" class="headerlink" title="Authors"></a>Authors</h2><p><strong>Luca Bernardi</strong></p>
<ul>
<li><a href="http://lucabernardi.com" target="_blank" rel="noopener">http://lucabernardi.com</a></li>
<li>@luka_bernardi</li>
<li><a href="http://github.com/lukabernardi" target="_blank" rel="noopener">http://github.com/lukabernardi</a></li>
</ul>
<p><strong>Alberto De Bortoli</strong></p>
<ul>
<li><a href="http://albertodebortoli.com" target="_blank" rel="noopener">http://albertodebortoli.com</a></li>
<li>@albertodebo</li>
<li><a href="http://github.com/albertodebortoli" target="_blank" rel="noopener">http://github.com/albertodebortoli</a></li>
</ul>
<h1 id="Conditionals"><a href="#Conditionals" class="headerlink" title="Conditionals"></a>Conditionals</h1><p>Conditional bodies should always use braces even when a conditional body could be written without braces (e.g., it is one line only) to prevent errors. These errors include adding a second line and expecting it to be part of the if-statement. Another, even more dangerous defect, may happen where the line “inside” the if-statement is commented out, and the next line unwittingly becomes part of the if-statement.</p>
<p><strong>Preferred:</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">if (!error) &#123;</span><br><span class="line">    return success;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>Not preferred:</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">if (!error)</span><br><span class="line">    return success;</span><br></pre></td></tr></table></figure>
<p>or</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">if (!error) return success;</span><br></pre></td></tr></table></figure>
<p>In February 2014 the well-know <a href="https://gotofail.com/" target="_blank" rel="noopener">goto fail</a> was found in the Apple’s SSL/TLS implementation.<br>The bug was due to a repeated <code>goto</code> statement after an <code>if</code> condition, wrapping the <code>if</code> branch in parentheses would have prevented the issue.</p>
<p>The code extract:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">static OSStatus</span><br><span class="line">SSLVerifySignedServerKeyExchange(SSLContext *ctx, bool isRsa, SSLBuffer signedParams,</span><br><span class="line">                                 uint8_t *signature, UInt16 signatureLen) &#123;</span><br><span class="line">  OSStatus        err;</span><br><span class="line">  ...</span><br><span class="line"></span><br><span class="line">  if ((err = SSLHashSHA1.update(&amp;hashCtx, &amp;serverRandom)) != 0)</span><br><span class="line">    goto fail;</span><br><span class="line">  if ((err = SSLHashSHA1.update(&amp;hashCtx, &amp;signedParams)) != 0)</span><br><span class="line">    goto fail;</span><br><span class="line">    goto fail;</span><br><span class="line">  if ((err = SSLHashSHA1.final(&amp;hashCtx, &amp;hashOut)) != 0)</span><br><span class="line">    goto fail;</span><br><span class="line">  ...</span><br><span class="line"></span><br><span class="line">fail:</span><br><span class="line">  SSLFreeBuffer(&amp;signedHashes);</span><br><span class="line">  SSLFreeBuffer(&amp;hashCtx);</span><br><span class="line">  return err;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Easy to spot, there are 2 <code>goto fail;</code> lines one after the other without parentheses. We definitely don’t want to risk creating bugs like the one above right?</p>
<p>In addition, this style is more consistent with all other conditionals, and therefore more easily scannable.</p>
<h2 id="Yoda-conditions"><a href="#Yoda-conditions" class="headerlink" title="Yoda conditions"></a>Yoda conditions</h2><p>Always avoid Yoda conditions. A Yoda condition is when comparing a constant to a variable instead of the other way around. It’s like saying “if blue is the sky” or “if tall is the man” instead of “if the sky is blue” or “if the man is tall”.</p>
<p><img src="/2018/11/13/禅与Objective-C编程艺术英文版/yoda.png" alt="Yoda"></p>
<p><strong>Preferred:</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">if ([myValue isEqual:@42]) &#123; ...</span><br></pre></td></tr></table></figure></p>
<p><strong>Not preferred:</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">if ([@42 isEqual:myValue]) &#123; ...</span><br></pre></td></tr></table></figure></p>
<h2 id="nil-and-BOOL-checks"><a href="#nil-and-BOOL-checks" class="headerlink" title="nil and BOOL checks"></a>nil and BOOL checks</h2><p>On a similar note of the Yoda conditions, also the nil check has been at the centre of debates. Some notous libraries out there use to check for an object to be or not to be nil as so:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">if (nil == myValue) &#123; ...</span><br></pre></td></tr></table></figure>
<p>One could argue that this is amiss or similar to a Yoda condition as nil is kind of a constant. The reason why sometimes programmers use this approach to prevent error that are difficult to debug. Consider the following code:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">if (myValue == nil) &#123; ...</span><br></pre></td></tr></table></figure>
<p>If a typo occurs and the programmer actually types:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">if (myValue = nil) &#123; ...</span><br></pre></td></tr></table></figure>
<p>it would be a valid assignment, indeed hard to debug if you are an experienced programmer (and therefore probably with some kind of visual impairment). That could never occur putting <code>nil</code> as argument on the left as it is nor assignable. There is also to be said that if the programmer uses this approach, he or she is perfectly aware of the underlying motivation and therefore the whole thing decades as it would be better to just double check what just typed.</p>
<p>More on this, to avoid all this fuss the approach that leave no space to doubt is to use the exclamation mark. Since <code>nil</code> resolves to <code>NO</code> it is unnecessary to compare it in conditions. Also, never compare something directly to <code>YES</code>, because <code>YES</code> is defined to 1 and a <code>BOOL</code> can be up to 8 bits as it is a char underneath.</p>
<p><strong>Preferred:</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">if (someObject) &#123; ...</span><br><span class="line">if (![someObject boolValue]) &#123; ...</span><br><span class="line">if (!someObject) &#123; ...</span><br></pre></td></tr></table></figure></p>
<p><strong>Not Preferred:</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">if (someObject == YES) &#123; ... // Wrong</span><br><span class="line">if (myRawValue == YES) &#123; ... // Never do this.</span><br><span class="line">if ([someObject boolValue] == NO) &#123; ...</span><br></pre></td></tr></table></figure></p>
<p>This allows also for more consistency across files and greater visual clarity.</p>
<h2 id="Golden-Path"><a href="#Golden-Path" class="headerlink" title="Golden Path"></a>Golden Path</h2><p>When coding with conditionals, the left hand margin of the code should be the “golden” or “happy” path.  That is, don’t nest <code>if</code> statements.  Multiple return statements are OK. This will avoid the growth of cyclomatic complexity and make the code easier to read because the important part of your method is not nested inside a branch but you have a visual clue of what is the most relevant code. </p>
<p><strong>Preferred:</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">- (void)someMethod &#123;</span><br><span class="line">    if (![someOther boolValue]) &#123;</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // Do something important</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>Not preferred:</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">- (void)someMethod &#123;</span><br><span class="line">    if ([someOther boolValue]) &#123;</span><br><span class="line">        // Do something important</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Complex-Conditions"><a href="#Complex-Conditions" class="headerlink" title="Complex Conditions"></a>Complex Conditions</h2><p>When you have complex condition in the <code>if</code> clause you should always extract them and assign to a <code>BOOL</code> variable to make more clear the logic and the meaning of every single conditions.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">BOOL nameContainsSwift  = [sessionName containsString:@&quot;Swift&quot;];</span><br><span class="line">BOOL isCurrentYear      = [sessionDateCompontents year] == 2014;</span><br><span class="line">BOOL isSwiftSession     = nameContainsSwift &amp;&amp; isCurrentYear;</span><br><span class="line"></span><br><span class="line">if (isSwiftSession) &#123;</span><br><span class="line">    // Do something very cool</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Ternary-Operator"><a href="#Ternary-Operator" class="headerlink" title="Ternary Operator"></a>Ternary Operator</h2><p>The Ternary operator, <code>?</code> , should only be used when it increases clarity or code neatness. A single condition is usually all that should be evaluated. Evaluating multiple conditions is usually more understandable as an if statement, or refactored into instance variables.</p>
<p><strong>Preferred:</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">result = a &gt; b ? x : y;</span><br></pre></td></tr></table></figure></p>
<p><strong>Not preferred:</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">result = a &gt; b ? x = c &gt; d ? c : d : y;</span><br></pre></td></tr></table></figure></p>
<p>When the second argument of the ternary operator (the if branch) returns the same object that was checked for existence in the condition, the following syntax is neat:</p>
<p><strong>Preferred:</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">result = object ? : [self createObject];</span><br></pre></td></tr></table></figure></p>
<p><strong>Not preferred:</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">result = object ? object : [self createObject];</span><br></pre></td></tr></table></figure></p>
<h2 id="Error-handling"><a href="#Error-handling" class="headerlink" title="Error handling"></a>Error handling</h2><p>When methods return an error parameter by reference, check the returned value, not the error variable.</p>
<p><strong>Preferred:</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">NSError *error = nil;</span><br><span class="line">if (![self trySomethingWithError:&amp;error]) &#123;</span><br><span class="line">    // Handle Error</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>Moreover, some of Apple’s APIs write garbage values to the error parameter (if non-NULL) in successful cases, so checking the error can cause false negatives (and subsequently crash).</p>
<h1 id="Case-Statements"><a href="#Case-Statements" class="headerlink" title="Case Statements"></a>Case Statements</h1><p>Braces are not required for case statements, unless enforced by the complier.<br>When a case contains more than one line, braces should be added.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">switch (condition) &#123;</span><br><span class="line">    case 1:</span><br><span class="line">        // ...</span><br><span class="line">        break;</span><br><span class="line">    case 2: &#123;</span><br><span class="line">        // ...</span><br><span class="line">        // Multi-line example using braces</span><br><span class="line">        break;</span><br><span class="line">       &#125;</span><br><span class="line">    case 3:</span><br><span class="line">        // ...</span><br><span class="line">        break;</span><br><span class="line">    default: </span><br><span class="line">        // ...</span><br><span class="line">        break;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>There are times when the same code can be used for multiple cases, and a fall-through should be used.  A fall-through is the removal of the ‘break’ statement for a case thus allowing the flow of execution to pass to the next case value.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">switch (condition) &#123;</span><br><span class="line">    case 1:</span><br><span class="line">    case 2:</span><br><span class="line">        // code executed for values 1 and 2</span><br><span class="line">        break;</span><br><span class="line">    default: </span><br><span class="line">        // ...</span><br><span class="line">        break;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>When using an enumerated type for a switch, <code>default</code> is not needed. For example:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">switch (menuType) &#123;</span><br><span class="line">    case ZOCEnumNone:</span><br><span class="line">        // ...</span><br><span class="line">        break;</span><br><span class="line">    case ZOCEnumValue1:</span><br><span class="line">        // ...</span><br><span class="line">        break;</span><br><span class="line">    case ZOCEnumValue2:</span><br><span class="line">        // ...</span><br><span class="line">        break;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Moreover, avoiding the default case, if new values are added to the enum, the programmer is immediately notified with a warning:</p>
<p><code>Enumeration value &#39;ZOCEnumValue3&#39; not handled in switch.</code></p>
<h3 id="Enumerated-Types"><a href="#Enumerated-Types" class="headerlink" title="Enumerated Types"></a>Enumerated Types</h3><p>When using <code>enum</code>s, it is recommended to use the new fixed underlying type specification because it has stronger type checking and code completion. The SDK now includes a macro to facilitate and encourage use of fixed underlying types — <code>NS_ENUM()</code></p>
<p><strong>Example:</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">typedef NS_ENUM(NSUInteger, ZOCMachineState) &#123;</span><br><span class="line">    ZOCMachineStateNone,</span><br><span class="line">    ZOCMachineStateIdle,</span><br><span class="line">    ZOCMachineStateRunning,</span><br><span class="line">    ZOCMachineStatePaused</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h1 id="Naming"><a href="#Naming" class="headerlink" title="Naming"></a>Naming</h1><h2 id="General-conventions"><a href="#General-conventions" class="headerlink" title="General conventions"></a>General conventions</h2><p>Apple naming conventions should be adhered to wherever possible, especially those related to <a href="https://developer.apple.com/library/mac/#documentation/Cocoa/Conceptual/MemoryMgmt/Articles/MemoryMgmt.html" target="_blank" rel="noopener">memory management rules</a> (<a href="http://stackoverflow.com/a/2865194/340508" target="_blank" rel="noopener">NARC</a>).</p>
<p>Long, descriptive method and variable names are good.</p>
<p><strong>Preferred:</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UIButton *settingsButton;</span><br></pre></td></tr></table></figure>
<p><strong>Not Preferred:</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UIButton *setBut;</span><br></pre></td></tr></table></figure></p>
<h2 id="Constants"><a href="#Constants" class="headerlink" title="Constants"></a>Constants</h2><p>Constants should be camel-case with all words capitalized and prefixed by the related class name for clarity.</p>
<p><strong>Preferred:</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">static const NSTimeInterval ZOCSignInViewControllerFadeOutAnimationDuration = 0.4;</span><br></pre></td></tr></table></figure></p>
<p><strong>Not Preferred:</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">static const NSTimeInterval fadeOutTime = 0.4;</span><br></pre></td></tr></table></figure></p>
<p>Constants are preferred over in-line string literals or numbers, as they allow for easy reproduction of commonly used variables and can be quickly changed without the need for find and replace. Constants should be declared as <code>static</code> constants and not <code>#define</code>s unless explicitly being used as a macro.</p>
<p><strong>Preferred:</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">static NSString * const ZOCCacheControllerDidClearCacheNotification = @&quot;ZOCCacheControllerDidClearCacheNotification&quot;;</span><br><span class="line">static const CGFloat ZOCImageThumbnailHeight = 50.0f;</span><br></pre></td></tr></table></figure></p>
<p><strong>Not Preferred:</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#define CompanyName @&quot;Apple Inc.&quot;</span><br><span class="line">#define magicNumber 42</span><br></pre></td></tr></table></figure>
<p>Constants exposed externally should use this pattern in the interface file:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">extern NSString *const ZOCCacheControllerDidClearCacheNotification;</span><br></pre></td></tr></table></figure>
<p>and the previously defined assignment should be in the implementation file.</p>
<p>You only need to add the namespace to a constant that is made public. Even though constants used within an implementation could follow a different pattern, there is no need not to be consistent with the rule.</p>
<h2 id="Methods"><a href="#Methods" class="headerlink" title="Methods"></a>Methods</h2><p>In method signatures, there should be a space after the method type (<code>-</code>/<code>+</code> symbol). There should be a space between the method segments (matching Apple’s style).  Always include a keyword and be descriptive with the word before the argument which describes the argument.</p>
<p>The usage of the word “and” is reserved.  It should not be used for multiple parameters as illustrated in the <code>initWithWidth:height:</code> example below.</p>
<p><strong>Preferred:</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">- (void)setExampleText:(NSString *)text image:(UIImage *)image;</span><br><span class="line">- (void)sendAction:(SEL)aSelector to:(id)anObject forAllCells:(BOOL)flag;</span><br><span class="line">- (id)viewWithTag:(NSInteger)tag;</span><br><span class="line">- (instancetype)initWithWidth:(CGFloat)width height:(CGFloat)height;</span><br></pre></td></tr></table></figure></p>
<p><strong>Not Preferred:</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">- (void)setT:(NSString *)text i:(UIImage *)image;</span><br><span class="line">- (void)sendAction:(SEL)aSelector :(id)anObject :(BOOL)flag;</span><br><span class="line">- (id)taggedView:(NSInteger)tag;</span><br><span class="line">- (instancetype)initWithWidth:(CGFloat)width andHeight:(CGFloat)height;</span><br><span class="line">- (instancetype)initWith:(int)width and:(int)height;  // Never do this.</span><br></pre></td></tr></table></figure>
<h2 id="Literals"><a href="#Literals" class="headerlink" title="Literals"></a>Literals</h2><p><code>NSString</code>, <code>NSDictionary</code>, <code>NSArray</code>, and <code>NSNumber</code> literals should be used whenever creating immutable instances of those objects. Pay special care that <code>nil</code> values not be passed into <code>NSArray</code> and <code>NSDictionary</code> literals, as this will cause a crash.</p>
<p><strong>For example:</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">NSArray *names = @[@&quot;Brian&quot;, @&quot;Matt&quot;, @&quot;Chris&quot;, @&quot;Alex&quot;, @&quot;Steve&quot;, @&quot;Paul&quot;];</span><br><span class="line">NSDictionary *productManagers = @&#123;@&quot;iPhone&quot; : @&quot;Kate&quot;, @&quot;iPad&quot; : @&quot;Kamal&quot;, @&quot;Mobile Web&quot; : @&quot;Bill&quot;&#125;;</span><br><span class="line">NSNumber *shouldUseLiterals = @YES;</span><br><span class="line">NSNumber *buildingZIPCode = @10018;</span><br></pre></td></tr></table></figure>
<p><strong>Not:</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">NSArray *names = [NSArray arrayWithObjects:@&quot;Brian&quot;, @&quot;Matt&quot;, @&quot;Chris&quot;, @&quot;Alex&quot;, @&quot;Steve&quot;, @&quot;Paul&quot;, nil];</span><br><span class="line">NSDictionary *productManagers = [NSDictionary dictionaryWithObjectsAndKeys: @&quot;Kate&quot;, @&quot;iPhone&quot;, @&quot;Kamal&quot;, @&quot;iPad&quot;, @&quot;Bill&quot;, @&quot;Mobile Web&quot;, nil];</span><br><span class="line">NSNumber *shouldUseLiterals = [NSNumber numberWithBool:YES];</span><br><span class="line">NSNumber *buildingZIPCode = [NSNumber numberWithInteger:10018];</span><br></pre></td></tr></table></figure>
<p>For the mutable counterparts of these classes we recommend, instead, the use of the explicit classes such as <code>NSMutableArray</code>, <code>NSMutableString</code>, and so on. </p>
<p>The following <strong>should be avoided</strong>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">NSMutableArray *aMutableArray = [@[] mutableCopy];</span><br></pre></td></tr></table></figure>
<p>The problems with the previous notation are both of efficiency and readability.<br>On the efficiency side, an unnecessarily immutable object is created and immediately thrown away; this unlikely will slow down your app (unless the method here is called frequently) but there is really no reason to do this just to save some characters.<br>Regarding the readability, we can see two problems here: the first is that when scanning through the code and seeing <code>@[]</code> your mind is immediately connected to and instance of <code>NSArray</code>, but in this case you need to stop and check more thoughtfully. Another aspect to take into account is that it would be very likely that someone with less experience will see your code and depending on his background he might not be very comfortable with the dichotomy between mutable and immutable objects. He or she could not be very familiar with the meaning of creating a mutable copy (obviously we are not suggesting that this knowledge is not necessary). Again, this is not something absolutely wrong but is more about code usability (that includes readability).</p>
<h1 id="Class"><a href="#Class" class="headerlink" title="Class"></a>Class</h1><h2 id="Class-name"><a href="#Class-name" class="headerlink" title="Class name"></a>Class name</h2><p>You should always prefix your class with <strong>three</strong> capital-case letters (two letters are reserved for Apple classes), this looking-weird practice is done to mitigate the notable absence of namespaces in our favorite language.<br>Some developers don’t follow this practice for model objects (we observed this practice especially for Core Data objects), we advice to strictly follow this convention also in the case of Core Data objects because you might end up merging your Managed Object Model with other MOMs, maybe coming from third party library.<br>As you may already have noticed, in this book the class (but not only) prefix is <code>ZOC</code>.</p>
<p>There is another good practice that you might want to follow while choosing the name for your classes: when you’re creating a subclass, you should put the specifying name part between the class prefix and the superclass name. This is better explained with an example: if you have a class named <code>ZOCNetworkClient</code>, example of subclass name will be <code>ZOCTwitterNetworkClient</code> (note “Twitter” between “ZOC” and “NetworkClient”); or, following the same rule, a <code>UIViewController</code> subclass would <code>ZOCTimelineViewController</code>.</p>
<h2 id="Initializer-and-dealloc"><a href="#Initializer-and-dealloc" class="headerlink" title="Initializer and dealloc"></a>Initializer and dealloc</h2><p>The recommended way to organize the  code is to  have <code>dealloc</code> method placed at the top of the implementation (directly after the <code>@synthesize</code> and <code>@dynamic</code> statements) and the <code>init</code> should be placed directly below the <code>dealloc</code> methods of any class. In case of multiple initializer the designated initializer should be placed as first method, because is the one where most likely there is more logic, and the secondary initializers should follow.<br>In these days with ARC, it is less likely that you will need to implement the dealloc method, but still the rationale is that by having the dealloc very close to your init methods, you are visually emphasizing the pairing between the methods. Usually in the dealloc method you will undo things that you have done in the init methods.</p>
<p><code>init</code> methods should be structured like this:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">- (instancetype)init &#123;</span><br><span class="line">    self = [super init]; // call the designated initializer</span><br><span class="line">    if (self) &#123;</span><br><span class="line">        // Custom initialization</span><br><span class="line">    &#125;</span><br><span class="line">    return self;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>It’s interesting to understand why do we need to set the value of <code>self</code> with the return value of <code>[super init]</code> and what happens if we don’t do that.</p>
<p>Let’s do a step back: we are so used to type expressions like <code>[[NSObject alloc] init]</code> that the difference between <code>alloc</code> and <code>init</code> fades away. A peculiarity of Objective-C  is the so called <em>two stage creation</em>. This means that the allocation and the initialization are two separate steps, and therefore two different methods need to be called: <code>alloc</code> and <code>init</code>.</p>
<ul>
<li><code>alloc</code> is responsible for the object allocation. This process involve the allocation of enough memory to hold the object from the application virtual memory, writing the <code>isa</code> pointer, initializes the retain count, and zeroing all the instance variables. </li>
<li><code>init</code> is responsible for initializing the object, that means brings the object in an usable state. This typically means set the instance variable of an object to reasonable and useful initial values.</li>
</ul>
<p>The <code>alloc</code> method will return a valid instance of an uninitialized object. Every message sent to this instance will be translated into an <code>objc_msgSend()</code> call where the parameter named <code>self</code> will be the pointer returned by <code>alloc</code>; in this way <code>self</code> is implicitly available in the scope of every methods.<br>To conclude the two step creation the first method sent to a newly allocated instance should, by convention, be an <code>init</code> method. Notably the <code>init</code> implementation of <code>NSObject</code> is not doing more than simply return <code>self</code>. </p>
<p>There is another important part of the contract with <code>init</code>: the method can (and should) signal to the caller that it wasn’t able to successfully finish the initialization by returning <code>nil</code>; the initialization can fail for various reasons such as an input passed in the wrong format or the failure in successfully initialize a needed object.<br>This is lead us to understand why you should always call <code>self = [super init]</code>, if your superclass is stating that it wasn’t able to successfully initialize itself, you must assume that you are in an inconsistent state and therefore do not proceed with your own initialization and return <code>nil</code> as well in your implementation. If you fail to do so you might end up dealing with an object that is not usable, that will not behave as expected and that might eventually lead to crash your app.</p>
<p>The ability to re-assign <code>self</code> can also be exploited by the <code>init</code> methods to return a different instance than the one they have been called on. Examples of this behavior are <a href="#class-cluster">Class cluster</a> or some Cocoa classes that returns the same instance for identical (immutable) objects.</p>
<h3 id="Designated-and-Secondary-Initializers"><a href="#Designated-and-Secondary-Initializers" class="headerlink" title="Designated and Secondary Initializers"></a>Designated and Secondary Initializers</h3><p>Objective-C have the concept of designated and secondary initializers.<br>The designated initializer is the initializer that takes the full complement of initialization parameters, the secondary initializers are one or more initializer methods that calls the designated initializer providing one or more default values for the initialization parameter.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">@implementation ZOCEvent</span><br><span class="line"></span><br><span class="line">- (instancetype)initWithTitle:(NSString *)title</span><br><span class="line">                         date:(NSDate *)date</span><br><span class="line">                     location:(CLLocation *)location &#123;</span><br><span class="line">    self = [super init];</span><br><span class="line">    if (self) &#123;</span><br><span class="line">        _title    = title;</span><br><span class="line">        _date     = date;</span><br><span class="line">        _location = location;</span><br><span class="line">    &#125;</span><br><span class="line">    return self;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (instancetype)initWithTitle:(NSString *)title</span><br><span class="line">                         date:(NSDate *)date &#123;</span><br><span class="line">    return [self initWithTitle:title date:date location:nil];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (instancetype)initWithTitle:(NSString *)title &#123;</span><br><span class="line">    return [self initWithTitle:title date:[NSDate date] location:nil];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<p>Given the above example <code>initWithTitle:date:location:</code> is the designated initializer. The other two init methods are the secondary initializers because they are just calling the designated initializer of the class where they are implemented.</p>
<h4 id="Designated-Initializer"><a href="#Designated-Initializer" class="headerlink" title="Designated Initializer"></a>Designated Initializer</h4><p>A class should always have one and only one designated initializer, all other init methods should call the designated one (even though there is an exception to this case).<br>This dichotomy does not dictate any requirement about which initializer should be called.<br>It should rather be valid to call any designated initializer in the class hierarchy, and it should be guaranteed that <em>all</em> the designated initializer in the class hierarchy are called starting from the furthest ancestor (typically <code>NSObject</code>) down to your class.<br>Practically speaking this means that the first initialization code executed is the furthest ancestor, and then going down to the class hierarchy; giving to all the classes in the hierarchy the chance to do their specific part of initialization. This totally make sense: you want that everything you inherit from your superclass is in an usable state before doing your actual work.<br>Even though it isn’t explicitly stated, all the classes in Apple’s frameworks are guaranteed to respect this contract and your classes should do the same to be sure to be a good citizen and behave correctly and as expected.</p>
<p>There are three different situations that may present when defining a new class:</p>
<ol>
<li>No need to override any initializers</li>
<li>Overriding designated initializer</li>
<li>Define a new designated initializer</li>
</ol>
<p>The first case is the most trivial: you don’t need to add any specific logic at the initialization of your class you simply rely on you parent designated initializer.<br>When you want to provide additional initialization logic you can decide to override the designated initializer. You should only override your immediate superclass’s designated initializer and be sure that your implementation calls the super of the method you’re overriding.<br>A typical example is whether you create a <code>UIViewController</code> subclass overriding <code>initWithNibName:bundle:</code>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">@implementation ZOCViewController</span><br><span class="line"></span><br><span class="line">- (id)initWithNibName:(NSString *)nibNameOrNil bundle:(NSBundle *)nibBundleOrNil &#123;</span><br><span class="line">    // call to the superclass designated initializer</span><br><span class="line">    self = [super initWithNibName:nibNameOrNil bundle:nibBundleOrNil];</span><br><span class="line">    if (self) &#123;</span><br><span class="line">        // Custom initialization</span><br><span class="line">    &#125;</span><br><span class="line">    return self;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<p>In case of <code>UIViewController</code> subclass it would be an error to override <code>init</code> as, in the case that the caller will try to initialize your class by calling <code>initWithNib:bundle</code>, your implementation will not be called. This also contradicts the rule that states that it should be valid to call any designated initializer.</p>
<p>In case you want to provide your own designated initializer there are three steps that you need to follow in order to guarantee the correct behavior:</p>
<ol>
<li>Declare your designated initializer, being sure to call your immediate superclass’s designated initializer.</li>
<li>Override the immediate superclass’s designated initializer calling your new designated initializer.</li>
<li>Document the new designated initializer. </li>
</ol>
<p>Lots of developers often miss the last two steps, this is not only a sign of little care, but in the case of the step two is clearly against the contract with the framework and can lead to very non-deterministic behaviors and bugs.<br>Let’s see an example of the correct way to implement this:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">@implementation ZOCNewsViewController</span><br><span class="line"></span><br><span class="line">- (id)initWithNews:(ZOCNews *)news &#123;</span><br><span class="line">    // call to the immediate superclass&apos;s designated initializer</span><br><span class="line">    self = [super initWithNibName:nil bundle:nil];</span><br><span class="line">    if (self) &#123;</span><br><span class="line">        _news = news;</span><br><span class="line">    &#125;</span><br><span class="line">    return self;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// Override the immediate superclass&apos;s designated initializer</span><br><span class="line">- (id)initWithNibName:(NSString *)nibNameOrNil bundle:(NSBundle *)nibBundleOrNil &#123;</span><br><span class="line">    // call the new designated initializer</span><br><span class="line">    return [self initWithNews:nil];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<p>In case you don’t override <code>initWithNibName:bundle:</code> and the caller decides to initialize you class with this method (that would be a perfectly valid option) the method <code>initWithNews:</code> will never get called and this will bring to an incorrect initialization sequence where the specific initialization logic of your class is not executed.</p>
<p>Even though it should be possible to infer what method is the designate initializer, it is always good to be clear and explicit (the future you or other developers that will work on your code will thank you). There are two strategies (non mutually exclusive) that you can decide to use: the first one you is to clearly state in the documentation which initializer is the designated one, but better yet you can be nice with your compiler and by using the compiler directive <code>__attribute__((objc_designated_initializer))</code> you can signal your intent.<br>Using that directive will also help the compiler helping you and in fact the compiler will issue a warning if in your new designate initializer you don’t call your superclass’s designated initializer.<br>There are, though, cases in which not calling the class designated initializer (and in turn providing the required parameters) and calling another designated initializer in the class hierarchy will bring the class in an useless state. Referring to the previous example, there is no point in instantiating a <code>ZOCNewsViewController</code> that should present a news, without the news itself. In this case you can enforce even more the need to call a very specific designated initializer by simply making all the other designated initializers not available. It is possible to do that by using another compiler directive <code>__attribute__((unavailable(&quot;Invoke the designated initializer&quot;)))</code>, decorating a method with this attribute will make the compiler issuing an error if you try to call this method.</p>
<p>Here the header relative to the implementation of the previous example (note the use of macros to don’t repeat the code and being less verbose).</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">@interface ZOCNewsViewController : UIViewController</span><br><span class="line"></span><br><span class="line">- (instancetype)initWithNews:(ZOCNews *)news ZOC_DESIGNATED_INITIALIZER;</span><br><span class="line">- (instancetype)initWithNibName:(NSString *)nibNameOrNil bundle:(NSBundle *)nibBundleOrNil ZOC_UNAVAILABLE_INSTEAD(initWithNews:);</span><br><span class="line">- (instancetype)init ZOC_UNAVAILABLE_INSTEAD(initWithNews:);</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<p>A corollary of what described above is that you should never call a secondary initializer from within the designated one (if the secondary initializer respects the contract, it will call the designated one). Doing so, the call is very likely to invoke one of the subclass’s overridden init methods and it will result in infinite recursion.</p>
<p>There is however an exception to all the rules laid out before that is whether an object conforms to the <code>NSCoding</code> protocol and it is initialized through the method <code>initWithCoder:</code>.<br>We should distinguish between the case where the superclass is adopting <code>NSCoding</code> and when not.<br>In the former case, if you just call <code>[super initWithCoder:]</code> you will probably have some shared initialization code with the designated initializer. A good way to handle this is to extract this code in a private method (i.e.  <code>p_commonInit</code>).<br>When your superclass does not adopt <code>NSCoding</code> the recommendation is to threat <code>initWithCoder:</code> as a secondary initializer and therefore call the <code>self</code> designated initializer. Note that this is against what suggested by Apple in the <a href="https://developer.apple.com/library/mac/documentation/cocoa/Conceptual/Archiving/Articles/codingobjects.html#//apple_ref/doc/uid/20000948-BCIHBJDE" target="_blank" rel="noopener">Archives and Serializations Programming Guide</a> where is stated:</p>
<blockquote>
<p>the object should first invoke its superclass’s designated initializer to initialize inherited state</p>
</blockquote>
<p>following this will actually lead to a non-deterministic behavior that will change if your class is or not a direct subclass of <code>NSObject</code>.</p>
<h4 id="Secondary-Initializer"><a href="#Secondary-Initializer" class="headerlink" title="Secondary Initializer"></a>Secondary Initializer</h4><p>As stated in the previous paragraph, a secondary initializer is a sort of convenience method to provide default values / behaviors to the designated initializer.<br>That said, it seems clear that you should not do any mandatory initialization in such method and you should never assume that this method will gets called. Again, the only methods that we are guaranteed to get called are the designated initializer.<br>This imply that in your secondary designated initializer you should always call another secondary initializer or your <code>self</code> designated initializer.  Sometimes, by mistake, one can type <code>super</code>; doing this will cause not to respect the aforementioned sequence of initialization (in this specific case by skipping the initialization of the current class).</p>
<h5 id="References"><a href="#References" class="headerlink" title="References"></a>References</h5><ul>
<li><a href="https://developer.apple.com/library/ios/Documentation/General/Conceptual/DevPedia-CocoaCore/ObjectCreation.html" target="_blank" rel="noopener">https://developer.apple.com/library/ios/Documentation/General/Conceptual/DevPedia-CocoaCore/ObjectCreation.html</a></li>
<li><a href="https://developer.apple.com/library/ios/documentation/General/Conceptual/CocoaEncyclopedia/Initialization/Initialization.html" target="_blank" rel="noopener">https://developer.apple.com/library/ios/documentation/General/Conceptual/CocoaEncyclopedia/Initialization/Initialization.html</a></li>
<li><a href="https://developer.apple.com/library/ios/Documentation/General/Conceptual/DevPedia-CocoaCore/MultipleInitializers.html" target="_blank" rel="noopener">https://developer.apple.com/library/ios/Documentation/General/Conceptual/DevPedia-CocoaCore/MultipleInitializers.html</a></li>
<li><a href="https://blog.twitter.com/2014/how-to-objective-c-initializer-patterns" target="_blank" rel="noopener">https://blog.twitter.com/2014/how-to-objective-c-initializer-patterns</a></li>
</ul>
<h3 id="instancetype"><a href="#instancetype" class="headerlink" title="instancetype"></a>instancetype</h3><p>One often doesn’t realize that Cocoa is full of conventions, and they can help the compiler being a little bit more smart. Whether the compiler encounters <code>alloc</code> or <code>init</code> methods, it will know that, even though the return type of both method is <code>id</code>, those methods will always return objects that are an instance of the receiving class’s type. As a consequence, this allows the compiler to provide and enforce the type checking (i.e. check that the methods called on the returned instance are valid). This kind of Clang smartness is due to what is called <a href="http://clang.llvm.org/docs/LanguageExtensions.html#related-result-types" target="_blank" rel="noopener">related result type</a>, meaning that </p>
<blockquote>
<p>messages sent to one of alloc and init methods will have the same static type as the instance of the receiver class</p>
</blockquote>
<p>To have more information about the convention that allow to automatically identify the related result type please refer to the <a href="(http://clang.llvm.org/docs/LanguageExtensions.html#related-result-types">appropriate section</a>) in the Clang Language Extensions guide.<br>A related result type can be explicitly stated using the <code>instancetype</code> keyword as return type and this can be very helpful in situation where a factory method or convenience constructor is used. This will hint the compiler with the correct type checking and, probably more important, will behave correctly also when subclassing.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">@interface ZOCPerson</span><br><span class="line">+ (instancetype)personWithName:(NSString *)name;</span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<p>Even though, according to the clang specification, <code>id</code> can be promoted to <code>instancetype</code> by the compiler. In the case of <code>alloc</code> or <code>init</code> we strongly encourage to use the return type <code>instancetype</code> for all class and instance methods that returns an instance of the class.<br>This is mostly to form the habit and to be consistent (and possibly having a more readable interface) in all your APIs. Once again, by making small adjustments to your code you can improve the readability: with a simple glance you will be able to distinguish which methods are returning an instance of your class. Sort of details you will appreciate in the long run.</p>
<h5 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h5><ul>
<li><a href="http://tewha.net/2013/02/why-you-should-use-instancetype-instead-of-id/" target="_blank" rel="noopener">http://tewha.net/2013/02/why-you-should-use-instancetype-instead-of-id/</a></li>
<li><a href="http://tewha.net/2013/01/when-is-id-promoted-to-instancetype/" target="_blank" rel="noopener">http://tewha.net/2013/01/when-is-id-promoted-to-instancetype/</a></li>
<li><a href="http://clang.llvm.org/docs/LanguageExtensions.html#related-result-types" target="_blank" rel="noopener">http://clang.llvm.org/docs/LanguageExtensions.html#related-result-types</a></li>
<li><a href="http://nshipster.com/instancetype/" target="_blank" rel="noopener">http://nshipster.com/instancetype/</a></li>
</ul>
<h3 id="Initialization-Patterns"><a href="#Initialization-Patterns" class="headerlink" title="Initialization Patterns"></a>Initialization Patterns</h3><h4 id="Class-cluster"><a href="#Class-cluster" class="headerlink" title="Class cluster"></a>Class cluster</h4><p>Class cluster as described in the Apple’s documentation is</p>
<blockquote>
<p>an architecture that groups a number of private, concrete subclasses under a public, abstract superclass.</p>
</blockquote>
<p>If this description sounds familiar probably your instinct is correct. Class cluster is the Apple lingo for the <a href="http://en.wikipedia.org/wiki/Abstract_factory_pattern" target="_blank" rel="noopener">Abstract Factory</a> design pattern.<br>The idea with class cluster is very simple: you typically have an abstract class that during the initialization process uses information, generally provided as parameters of the initializer method or available in the environment, to apply a logic and instantiate a concrete subclass. This “public facing” class should internally have a good knowledge of its subclass to be able to return the private subclass that best suited the task.<br>This pattern is very useful because it removes the complexity of this initialization logic from the caller that only knows about the interface to communicate with the object, without actually caring about the underlying  implementation.<br>Class clusters are widely used in the Apple’s frameworks; some of the most notably examples are <code>NSNumber</code> that can return an appropriate subclass depending of the type of number provided (Integer, Float, etc…) or <code>NSArray</code> that will return a concrete subclass with the best storage policy.<br>The beauty of this pattern is that the caller can be completely unaware of the concrete subclass; in fact it can be used when designing a library to be able to swap the underlaying returned class without leaking any implementation detail as long as is respectful of the contract established in the abstract class.</p>
<p>In our experience the use of a Class Cluster can be very helpful in removing a lot of conditional code.<br>A typical example of this is when you have the same UIViewController subclass for both iPhone and iPad, but the behavior is slightly different depending on the the device.<br>The naïve implementation is to put some conditional code checking the device in the methods where the different logic is needed, even though initially the place where this conditional logic is applied may be quite few they naturally tend to grow producing an explosion of code paths.<br>A better design can be achieved by creating an abstract and generic view controller that will contain all the shared logic and then two specializing subclass for every device.<br>The generic view controller will check the current device idiom and depending on that it will return the appropriate subclass.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">@implementation ZOCKintsugiPhotoViewController</span><br><span class="line"></span><br><span class="line">- (id)initWithPhotos:(NSArray *)photos &#123;</span><br><span class="line">    if ([self isMemberOfClass:ZOCKintsugiPhotoViewController.class]) &#123;</span><br><span class="line">        self = nil;</span><br><span class="line"></span><br><span class="line">        if ([UIDevice isPad]) &#123;</span><br><span class="line">            self = [[ZOCKintsugiPhotoViewController_iPad alloc] initWithPhotos:photos];</span><br><span class="line">        &#125;</span><br><span class="line">        else &#123;</span><br><span class="line">            self = [[ZOCKintsugiPhotoViewController_iPhone alloc] initWithPhotos:photos];</span><br><span class="line">        &#125;</span><br><span class="line">        return self;</span><br><span class="line">    &#125;</span><br><span class="line">    return [super initWithNibName:nil bundle:nil];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<p>The previous code example show how to create a class cluster. First of all the <code>[self isMemberOfClass:ZOCKintsugiPhotoViewController.class]</code> is done to prevent the necessity to override the init method in the subclass in order to prevent an infinite recursion.<br>When <code>[[ZOCKintsugiPhotoViewController alloc] initWithPhotos:photos]</code> will get called the previous check will be true, the <code>self = nil</code> is to remove every reference to the instance of <code>ZOCKintsugiPhotoViewController</code> that it will be deallocated , following there is the logic to choose which subclass should be initialized.<br>Let’s assume that we are running this code on an iPhone and that <code>ZOCKintsugiPhotoViewController_iPhone</code> is not overriding <code>initWithPhotos:</code>; in this case, when executing <code>self = [[ZOCKintsugiPhotoViewController_iPhone alloc] initWithPhotos:photos];</code> the <code>ZOCKintsugiPhotoViewController</code> will be called and here is when the first check comes handy, given that now is not exactly  <code>ZOCKintsugiPhotoViewController</code> the check will be false calling the <code>return [super initWithNibName:nil bundle:nil];</code> this will make continue the initialization following the correct initialization path highlighted in the previous session.</p>
<h4 id="Singleton"><a href="#Singleton" class="headerlink" title="Singleton"></a>Singleton</h4><p>Generally avoid using them if possible, use dependency injection instead.<br>Nevertheless, unavoidable singleton objects should use a thread-safe pattern for creating their shared instance. As of GCD, it is possible to use the <code>dispatch_once()</code> function to</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+ (instancetype)sharedInstance &#123;</span><br><span class="line">    static id sharedInstance = nil;</span><br><span class="line">    static dispatch_once_t onceToken = 0;</span><br><span class="line">    dispatch_once(&amp;onceToken, ^&#123;</span><br><span class="line">        sharedInstance = [[self alloc] init];</span><br><span class="line">    &#125;);</span><br><span class="line">    return sharedInstance;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>The use of dispatch_once(), which is synchronous, replaces the following, yet obsolete, idiom:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+ (instancetype)sharedInstance &#123;</span><br><span class="line">    static id sharedInstance;</span><br><span class="line">    @synchronized(self) &#123;</span><br><span class="line">        if (sharedInstance == nil) &#123;</span><br><span class="line">            sharedInstance = [[MyClass alloc] init];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return sharedInstance;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>The benefits of <code>dispatch_once()</code> over this are that it’s faster, it’s also semantically cleaner, because the entire idea of dispatch_once() is “perform something once and only once”, which is precisely what we’re doing. This approach will also prevent <a href="http://cocoasamurai.blogspot.com/2011/04/singletons-your-doing-them-wrong.html" target="_blank" rel="noopener">possible and sometimes prolific crashes</a>.</p>
<p>Classic examples of acceptable singleton objects are the GPS and the accelerometer of a device. Even though Singleton objects can be subclassed, the cases where this comes useful are rare. The interface should put in evidence that the given class is intended to be used as a Singleton. Therefore, often a single public <code>sharedInstance</code> class method would suffice and no writable properties should be exposed.</p>
<p>Trying to use a Singleton as a container for objects to share across the code or layer of your application is ugly and nasty, and should be interpreted as a design smell.</p>
<h2 id="Properties"><a href="#Properties" class="headerlink" title="Properties"></a>Properties</h2><p>Properties should be named as descriptively as possible, avoiding abbreviation, and camel-case with the leading word being lowercase. Luckily our tool of choice is able to autocomplete everything we type (well… almost everything. Yes, I’m looking at you Xcode’s Derived Data) so there is no reason to save a couple of chars, and it’s better to convey as much information as possible in your source code.</p>
<p><strong>For example:</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">NSString *text;</span><br></pre></td></tr></table></figure></p>
<p><strong>Not:</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">NSString* text;</span><br><span class="line">NSString * text;</span><br></pre></td></tr></table></figure></p>
<p>(Note: this preference is different for constants. This is actually a matter of common sense and readability: C++ developers often prefer to separate the type from the name of the variable, and as the type in its pure form would be <code>NSString*</code> (for objects allocated on the heap, as in C++ it’d be possible to allocate objects on the stack) the format <code>NSString* text;</code> is used.)</p>
<p>Use auto-synthesize for properties rather than manual <code>@synthesize</code> statements unless your properties are part of a protocol rather than a concrete class. If Xcode can automatically synthesize the variable, then let it do so; moreover it’d be a part of the code that is just redundant and that you have to maintain without a real benefit.</p>
<p>You should always use the setter and getter to access the property, except for the <code>init</code> and <code>dealloc</code> methods. Generally speaking, using the property gives you an increased visual clue that what you’re accessing is outside you current scope and therefor is subject to side-effect.</p>
<p>You should always prefer the setter because:</p>
<ul>
<li>Using the setter will respect the defined memory-management semantics (<code>strong</code>, <code>weak</code>, <code>copy</code> etc…). This was definitely more relevant before ARC but it’s still relevant; think, for example, the <code>copy</code> semantic, every time you use the setter the passed value is copied without any additional operation;</li>
<li>KVO notifications (<code>willChangeValueForKey</code>, <code>didChangeValueForKey</code>) are fired automatically;</li>
<li>It is easier to debug: you can set a breakpoint on the property declaration and the breakpoint will fire every time the getter/setter is called, or you can set a breakpoint inside a custom setter/getter;</li>
<li>It allows to add extra logic when setting a value in a single place.</li>
</ul>
<p>You should alway prefer the getter:</p>
<ul>
<li>It is resilient to future change (e.g. the property is dynamically generated);</li>
<li>It allows subclassing;</li>
<li>It is easier to debug (i.e. Is possible to put a breakpoint in the getter and see who’s accessing that specific getter);</li>
<li>It makes the intent clear and explicit: by accessing an ivar <code>_anIvar</code> you are actually accessing <code>self-&gt;_anIvar</code>. This can lead to problems, for instance, accessing the iVar inside a block (you’re capturing and retaining self even if you don’t explicitly see the keyword <code>self</code>);</li>
<li>It automatically fires KVO notifications;</li>
<li>The overhead introduced by the message sending is very low and in the most of the case is negligible. For more information on the performance penalty introduced by the property you may find an interesting performance rundown  <a href="http://blog.bignerdranch.com/4005-should-i-use-a-property-or-an-instance-variable/" target="_blank" rel="noopener">Should I Use a Property or an Instance Variable?</a></li>
</ul>
<h4 id="Init-and-Dealloc"><a href="#Init-and-Dealloc" class="headerlink" title="Init and Dealloc"></a>Init and Dealloc</h4><p>There is however an exception to what stated before: you must never use the setter (or the getter) in the <code>init</code> (and other initializer method), and instead you should always access directly the variable using the instance variable. This is to be defensive against subclassing: eventually a subclass can override the setter (or getter) and trying to call other methods, access properties or iVars that aren’t in a consistent state or fully-initialized. Remember that an object is considered fully initialized and in a consistent state only after the init returns. The same applies for the <code>dealloc</code> method (during the <code>dealloc</code> method an object can be in a inconsistent state). This is also clearly stated many times over time:</p>
<ul>
<li><a href="https://developer.apple.com/library/mac/documentation/Cocoa/Conceptual/MemoryMgmt/Articles/mmPractical.html#//apple_ref/doc/uid/TP40004447-SW6" target="_blank" rel="noopener">Advanced Memory Management Programming Guide</a> under the self-explanatory section “Don’t Use Accessor Methods in Initializer Methods and dealloc”;</li>
<li><a href="http://adcdownload.apple.com//wwdc_2012/wwdc_2012_session_pdfs/session_413__migrating_to_modern_objectivec.pdf" target="_blank" rel="noopener">Migrating to Modern Objective-C</a> at WWDC 2012 at slide 27;</li>
<li>in a <a href="https://github.com/NYTimes/objective-c-style-guide/issues/6" target="_blank" rel="noopener">pull request</a> form Dave DeLong’s. </li>
</ul>
<p>Moreover, using the setter in the init will not play nicely with <code>UIAppearence</code> proxy (please refer to <a href="http://petersteinberger.com/blog/2013/uiappearance-for-custom-views/" target="_blank" rel="noopener">UIAppearance for Custom Views</a> for additional informations).</p>
<h4 id="Dot-Notation"><a href="#Dot-Notation" class="headerlink" title="Dot-Notation"></a>Dot-Notation</h4><p>When using the setter/getter always prefer the dot notation.<br>Dot-notation should <em>always</em> be used for accessing and mutating properties.</p>
<p><strong>For example:</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">view.backgroundColor = [UIColor orangeColor];</span><br><span class="line">[UIApplication sharedApplication].delegate;</span><br></pre></td></tr></table></figure></p>
<p><strong>Not:</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[view setBackgroundColor:[UIColor orangeColor]];</span><br><span class="line">UIApplication.sharedApplication.delegate;</span><br></pre></td></tr></table></figure></p>
<p>Using the dot notation will ensure a visual clue to help distinguish between a property or a typical method call.</p>
<h3 id="Property-Declaration"><a href="#Property-Declaration" class="headerlink" title="Property Declaration"></a>Property Declaration</h3><p>The preferred way to declare a property is the following format</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@property (nonatomic, readwrite, copy) NSString *name;</span><br></pre></td></tr></table></figure>
<p>The property attributes should be ordered as following: atomicity, read/write and memory-managements storage. By doing this your attributes are more likely to change in the right most position and it’s easier to scan with your eyes.</p>
<p>You must use <code>nonatomic</code> attribute, unless strictly necessary. On iOS, the locking introduced by <code>atomic</code> can significantly affect the performances.</p>
<p>Properties that stores a block, in order to keep it alive after the end of the declaration scope, must be <code>copy</code> (the block is initially created on the stack, calling <code>copy</code> cause the block to be copied on the heap).</p>
<p>In order to achieve a public getter and a private setter, you can declare the public property as <code>readonly</code> and re-declare the same property in the the class extension as <code>readwrite</code>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@interface MyClass : NSObject</span><br><span class="line">@property (nonatomic, readonly) NSObject *object</span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@implementation MyClass ()</span><br><span class="line">@property (nonatomic, readwrite, strong) NSObject *object</span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<p>If the name of a <code>BOOL</code> property is expressed as an adjective, the property can omit the “is” prefix but specifies the conventional name for the get accessor, for example:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@property (assign, getter=isEditable) BOOL editable;</span><br></pre></td></tr></table></figure>
<p>Text and example taken from the <a href="https://developer.apple.com/library/mac/#documentation/Cocoa/Conceptual/CodingGuidelines/Articles/NamingIvarsAndTypes.html#//apple_ref/doc/uid/20001284-BAJGIIJE" target="_blank" rel="noopener">Cocoa Naming Guidelines</a>.</p>
<p>In the implementation file avoid the use of <code>@synthesize</code>, Xcode is already adding this for you.</p>
<h4 id="Private-Properties"><a href="#Private-Properties" class="headerlink" title="Private Properties"></a>Private Properties</h4><p>Private properties should be declared in class extensions (anonymous categories) in the implementation file of a class. Named categories (e.g. <code>ZOCPrivate</code>) should never be used unless extending another class.</p>
<p><strong>For example:</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">@interface ZOCViewController ()</span><br><span class="line">@property (nonatomic, strong) UIView *bannerView;</span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<h3 id="Mutable-Object"><a href="#Mutable-Object" class="headerlink" title="Mutable Object"></a>Mutable Object</h3><p>Any property that potentially can be set with a mutable object (e.g. <code>NSString</code>,<code>NSArray</code>,<code>NSURLRequest</code>) must have the memory-management type to <code>copy</code>. This is done in order to ensure the encapsulation and prevent that the value is changed after the property is set without that the object know it.</p>
<p>You should also avoid to expose mutable object in the public interface, because this allows clients of your class to change your own internal representation and break the encapsulation. You can provide a read-only property that returns an immutable copy of your object:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">/* .h */</span><br><span class="line">@property (nonatomic, readonly) NSArray *elements</span><br><span class="line"></span><br><span class="line">/* .m */</span><br><span class="line">- (NSArray *)elements &#123;</span><br><span class="line">    return [self.mutableElements copy];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Lazy-Loading"><a href="#Lazy-Loading" class="headerlink" title="Lazy Loading"></a>Lazy Loading</h3><p>There are cases when instantiating an object can be expensive and/or needs to be configured once and has some configuration involved that you don’t want to clutter the caller method.</p>
<p>In this case, instead of allocating the object in the init method one could opt for overriding the property getter for lazy instantiation. Usually the template for this kind of operation is the following:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">- (NSDateFormatter *)dateFormatter &#123;</span><br><span class="line">    if (!_dateFormatter) &#123;</span><br><span class="line">        _dateFormatter = [[NSDateFormatter alloc] init];</span><br><span class="line">        NSLocale *enUSPOSIXLocale = [[NSLocale alloc] initWithLocaleIdentifier:@&quot;en_US_POSIX&quot;];</span><br><span class="line">        [dateFormatter setLocale:enUSPOSIXLocale];</span><br><span class="line">        [dateFormatter setDateFormat:@&quot;yyyy-MM-dd&apos;T&apos;HH:mm:ss.SSSSS&quot;];</span><br><span class="line">    &#125;</span><br><span class="line">    return _dateFormatter;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Even though this can be beneficial in some circumstance we advice to be thoughtful when you decide to do, and actually this should be avoided. The following are the arguments against the use of property with lazy initialization:</p>
<ul>
<li>The getter should not have side effect. By looking a getter on the right-hand side you’re not thinking that this is causing an object to be allocated or will lead to side effect. In fact, trying to call a getter without using the returned value the compiler will emit the warning “getter should not used for side effect”;</li>
<li>You’re moving the cost of the initialization as side effect of the first access, this will lead to difficulties to optimize performance issues (that are also hard to instrument);</li>
<li>The moment of instantiation can be non deterministic: for example you’re expecting that this property is first accessed by a method but as soon as you change the class implementation, the accessor gets called before your original expectation. This can cause problems especially if the instantiation logic has dependencies on other state of the class that may be different. In general is better to explicitly express the dependency;</li>
<li>This behavior might not be KVO friendly. If the getter changes the reference it should fire a KVO notification for notify the change, it can be weird to receive a change notification when accessing a getter.</li>
</ul>
<h2 id="Methods-1"><a href="#Methods-1" class="headerlink" title="Methods"></a>Methods</h2><h3 id="Parameter-Assert"><a href="#Parameter-Assert" class="headerlink" title="Parameter Assert"></a>Parameter Assert</h3><p>Your method may require some parameter to satisfy certain condition (i.e. not to be nil): in such cases it’s a good practice to use <code>NSParameterAssert()</code> to assert the condition and eventually throwing an exception.</p>
<h3 id="Private-methods"><a href="#Private-methods" class="headerlink" title="Private methods"></a>Private methods</h3><p>Never prefix your private method with a single underscore <code>_</code>, this prefix is reserved by Apple, doing otherwise expose you to the risk of overriding an existing Apple’s private method. A recommended approach is to use the <code>p_</code> prefix (e.g. <code>p_privateMethod</code>).</p>
<h2 id="Equality"><a href="#Equality" class="headerlink" title="Equality"></a>Equality</h2><p>In case you need to implement equality remember the contract: you need to implement both the <code>isEqual</code> and the <code>hash</code> methods. If two objects are considered equal through <code>isEqual</code>, the <code>hash</code> method must return the same value, but if <code>hash</code> returns the same value the object are not guaranteed to be equals.</p>
<p>This contracts boils down to how the lookup of those objects is done when are stored in collections (i.e. <code>NSDictionary</code> and <code>NSSet</code> use hash table data structure underneath).</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">@implementation ZOCPerson</span><br><span class="line"></span><br><span class="line">- (BOOL)isEqual:(id)object &#123;</span><br><span class="line">    if (self == object) &#123;</span><br><span class="line">        return YES;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if (![object isKindOfClass:[ZOCPerson class]]) &#123;</span><br><span class="line">        return NO;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // check objects properties (name and birthday) for equality</span><br><span class="line">    ...</span><br><span class="line">    return propertiesMatch;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (NSUInteger)hash &#123;</span><br><span class="line">    return [self.name hash] ^ [self.birthday hash];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<p>It is important to notice that the hash method must not return a constant. This is a typical error and causes serious problems as it will cause 100% of collisions in the hash table as the value returned by the hash method is actually used as key in the hash table.</p>
<p>You should also always implement a typed equality check method with the following format <code>isEqualTo&lt;#class-name-without-prefix#&gt;:</code><br>If you can, it’s always preferable to call the typed equal method in order to avoid the type checking overhead.</p>
<p>A complete pattern for the isEqual* method should be as so:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">- (BOOL)isEqual:(id)object &#123;</span><br><span class="line">    if (self == object) &#123;</span><br><span class="line">        return YES;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if (![object isKindOfClass:[ZOCPerson class]]) &#123;</span><br><span class="line">        return NO;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return [self isEqualToPerson:(ZOCPerson *)object];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (BOOL)isEqualToPerson:(Person *)person &#123;</span><br><span class="line">    if (!person) &#123;</span><br><span class="line">        return NO;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    BOOL namesMatch = (!self.name &amp;&amp; !person.name) ||</span><br><span class="line">                       [self.name isEqualToString:person.name];</span><br><span class="line">    BOOL birthdaysMatch = (!self.birthday &amp;&amp; !person.birthday) ||</span><br><span class="line">                           [self.birthday isEqualToDate:person.birthday];</span><br><span class="line"></span><br><span class="line">    return haveEqualNames &amp;&amp; haveEqualBirthdays;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Given an object instance the computation of the <code>hash</code> should be deterministic, this is extremely important if the object is added to a container object (i.e. <code>NSArray</code>, <code>NSSet</code>, or <code>NSDictionary</code>) otherwise the behavior will be undefined (all container objects use the object’s hash to do the lookup and enforce specific property like the uniqueness of the objects contained). That said, the calculation of the hash should always be made only by using immutable properties or, better yet, by guarantee the immutability of the objects.</p>
<h1 id="Categories"><a href="#Categories" class="headerlink" title="Categories"></a>Categories</h1><p>It is ugly, we know, but categories should always be prefixed with your lower case prefix and an underscore i.e. <code>- (id)zoc_myCategoryMethod</code>. This practice is also <a href="https://developer.apple.com/library/ios/documentation/cocoa/conceptual/ProgrammingWithObjectiveC/CustomizingExistingClasses/CustomizingExistingClasses.html#//apple_ref/doc/uid/TP40011210-CH6-SW4" target="_blank" rel="noopener">recommended by Apple</a>.</p>
<p>This is absolutely needed because implementing a category method with a name already existing in the extended object or in another category may result in an undefined behavior. Practically, what is going to happen is that the implementation of the last category loaded will be the one that gets called. </p>
<p>In case you want to be sure that you’re not replacing any implementation with your own category you can set the environment variable <code>OBJC_PRINT_REPLACED_METHODS</code> to <code>YES</code>, this will print in the console the names of the methods that have been replaced.<br>At the time of writing LLVM 5.1 does not emit any warning or error for this, so be careful and don’t override methods in categories.</p>
<p>A good practice is to use prefix also for category names.</p>
<p><strong>Example:</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">@interface NSDate (ZOCTimeExtensions)</span><br><span class="line">- (NSString *)zoc_timeAgoShort;</span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<p><strong>Not:</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">@interface NSDate (ZOCTimeExtensions)</span><br><span class="line">- (NSString *)timeAgoShort;</span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<p>Category can be used to group related method in a header file. This is a very common practice in Apple’s framework (nearby is proposed an extract from <code>NSDate</code> header) and we strongly encourage to do the same in your code.<br>In our experience creating this groups can be helpful in further refactoring: when the interface of a class starts growing can be a signal that your class is doing to much and therefore violating the Single Responsibility Principle, the previously created groups be used to better understand the different responsibilities and help in breaking down the class in more self-contained components.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">@interface NSDate : NSObject &lt;NSCopying, NSSecureCoding&gt;</span><br><span class="line"></span><br><span class="line">@property (readonly) NSTimeInterval timeIntervalSinceReferenceDate;</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@interface NSDate (NSDateCreation)</span><br><span class="line"></span><br><span class="line">+ (instancetype)date;</span><br><span class="line">+ (instancetype)dateWithTimeIntervalSinceNow:(NSTimeInterval)secs;</span><br><span class="line">+ (instancetype)dateWithTimeIntervalSinceReferenceDate:(NSTimeInterval)ti;</span><br><span class="line">+ (instancetype)dateWithTimeIntervalSince1970:(NSTimeInterval)secs;</span><br><span class="line">+ (instancetype)dateWithTimeInterval:(NSTimeInterval)secsToBeAdded sinceDate:(NSDate *)date;</span><br><span class="line">// ...</span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<h1 id="Protocols"><a href="#Protocols" class="headerlink" title="Protocols"></a>Protocols</h1><p>A great miss in the Objective-C world is the outcome of the latest decades about abstract interfaces. The term interface is typically used to refer to the <code>.h</code> file of a class but it has also another meaning well known to Java programmers which is basically used to describe to a set of methods not backed by a concrete implementation.<br>In Objective-C the latter case is achieved by using protocols. For historical reasons, protocols (used as Java interfaces) are not so much used in Objective-C code and in general by the community. It’s mainly because the majority of the code developed at Apple don’t embrace this approach and almost all developers tend to follow Apple’s patterns and guidelines. Apple uses protocols almost only for the delegation pattern.<br>The concept of abstract interface is very powerful, has roots in the computer science history and there are no reasons to pretend it can’t be used in Objective-C.</p>
<p>Here will be explained a powerful usage of protocols (intended as abstract interfaces) going through a concrete example: starting from a very bad designed architecture up to reaching a very well and reusable piece of code.</p>
<p>The example presented is the implementation of a RSS feed reader (think of it as a common test task asked during technical interviews).</p>
<p>The requirement is straightforward: presenting a remote RSS feed in a table view.</p>
<p>A very naïve approach would be to create a <code>UITableViewController</code> subclass and code the entire logic for the retrieving of the feed data, the parsing and the displaying in one place, which is, in other words, a MVC (Massive View Controller). This would work but it’s very poorly designed and unfortunately it’d suffice to pass the interview step in some not-so-demanding tech startups.</p>
<p>A minimal step forward would be to follow the Single Responsibility Principle and create at least 2 components to do the different tasks:</p>
<ul>
<li>a feed parser to parse the results gathered from an endpoint</li>
<li>a feed reader to display the results</li>
</ul>
<p>The interfaces for these classes could be as so:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">@interface ZOCFeedParser : NSObject</span><br><span class="line"></span><br><span class="line">@property (nonatomic, weak) id &lt;ZOCFeedParserDelegate&gt; delegate;</span><br><span class="line">@property (nonatomic, strong) NSURL *url;</span><br><span class="line"></span><br><span class="line">- (id)initWithURL:(NSURL *)url;</span><br><span class="line"></span><br><span class="line">- (BOOL)start;</span><br><span class="line">- (void)stop;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">@interface ZOCTableViewController : UITableViewController</span><br><span class="line"></span><br><span class="line">- (instancetype)initWithFeedParser:(ZOCFeedParser *)feedParser;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<p>The <code>ZOCFeedParser</code> is initialized with a <code>NSURL</code> to the endpoint to fetch the RSS feed (under the hood it will probably use NSXMLParser and NSXMLParserDelegate to create meaningful data) and the <code>ZOCTableViewController</code> is initialized with the parser. We want it to display the values retrieved by the parser and we do it using delegation with the following protocol:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">@protocol ZOCFeedParserDelegate &lt;NSObject&gt;</span><br><span class="line">@optional</span><br><span class="line">- (void)feedParserDidStart:(ZOCFeedParser *)parser;</span><br><span class="line">- (void)feedParser:(ZOCFeedParser *)parser didParseFeedInfo:(ZOCFeedInfoDTO *)info;</span><br><span class="line">- (void)feedParser:(ZOCFeedParser *)parser didParseFeedItem:(ZOCFeedItemDTO *)item;</span><br><span class="line">- (void)feedParserDidFinish:(ZOCFeedParser *)parser;</span><br><span class="line">- (void)feedParser:(ZOCFeedParser *)parser didFailWithError:(NSError *)error;</span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<p>It’s a perfectly reasonable and suitable protocol to deal with RSS, I’d say. The view controller will conform to it in the public interface:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@interface ZOCTableViewController : UITableViewController &lt;ZOCFeedParserDelegate&gt;</span><br></pre></td></tr></table></figure>
<p>and the final creation code is like so: </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">NSURL *feedURL = [NSURL URLWithString:@&quot;http://bbc.co.uk/feed.rss&quot;];</span><br><span class="line"></span><br><span class="line">ZOCFeedParser *feedParser = [[ZOCFeedParser alloc] initWithURL:feedURL];</span><br><span class="line"></span><br><span class="line">ZOCTableViewController *tableViewController = [[ZOCTableViewController alloc] initWithFeedParser:feedParser];</span><br><span class="line">feedParser.delegate = tableViewController;</span><br></pre></td></tr></table></figure>
<p>So far so good and you’re probably happy with this new code, but how much of this code can be effectively reused? The view controller can only deal with objects of type <code>ZOCFeedParser</code>: at this point we just split the code in 2 components without any additional and tangible value than separation of responsibilities.</p>
<p>The responsibility of the view controller should be to “display items provided by <someone>“ but if we are allowed to pass to it only <code>ZOCFeedParser</code> objects this can’t hold. Here surfaces the need for a more general type of object to be used by the view controller.</someone></p>
<p>We modify our feed parser introducing the <code>ZOCFeedParserProtocol</code> protocol (in the ZOCFeedParserProtocol.h file where also <code>ZOCFeedParserDelegate</code> will be).</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">@protocol ZOCFeedParserProtocol &lt;NSObject&gt;</span><br><span class="line"></span><br><span class="line">@property (nonatomic, weak) id &lt;ZOCFeedParserDelegate&gt; delegate;</span><br><span class="line">@property (nonatomic, strong) NSURL *url;</span><br><span class="line"></span><br><span class="line">- (BOOL)start;</span><br><span class="line">- (void)stop;</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@protocol ZOCFeedParserDelegate &lt;NSObject&gt;</span><br><span class="line">@optional</span><br><span class="line">- (void)feedParserDidStart:(id&lt;ZOCFeedParserProtocol&gt;)parser;</span><br><span class="line">- (void)feedParser:(id&lt;ZOCFeedParserProtocol&gt;)parser didParseFeedInfo:(ZOCFeedInfoDTO *)info;</span><br><span class="line">- (void)feedParser:(id&lt;ZOCFeedParserProtocol&gt;)parser didParseFeedItem:(ZOCFeedItemDTO *)item;</span><br><span class="line">- (void)feedParserDidFinish:(id&lt;ZOCFeedParserProtocol&gt;)parser;</span><br><span class="line">- (void)feedParser:(id&lt;ZOCFeedParserProtocol&gt;)parser didFailWithError:(NSError *)error;</span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<p>Notice that the delegate protocol now deals with objects conforming to our new protocol and the interface file of the ZOCFeedParser would be more skinny:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">@interface ZOCFeedParser : NSObject &lt;ZOCFeedParserProtocol&gt;</span><br><span class="line"></span><br><span class="line">- (id)initWithURL:(NSURL *)url;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<p>As <code>ZOCFeedParser</code>now conforms to <code>ZOCFeedParserProtocol</code>, it must implement all the required methods.<br>At this point the view controller can accept any object conforming to the new protocol, having the certaincy that the object will respond to <code>start</code> and <code>stop</code> methods and that it will provide info through the delegate property. This is all the view controller should know about the given objects and no implementation details should concern it.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">@interface ZOCTableViewController : UITableViewController &lt;ZOCFeedParserDelegate&gt;</span><br><span class="line"></span><br><span class="line">- (instancetype)initWithFeedParser:(id&lt;ZOCFeedParserProtocol&gt;)feedParser;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<p>The change in the above snippet of code might seem a minor change, but actually it is a huge improvement as the view controller would work against a contract rather than a concrete implementation. This leads to many advantages:</p>
<ul>
<li>the view controller can now accept any object that provide some information via the delegate property: this can be a RSS remote feed parser, a local one, a service that read other types of data remotely or even a service that fetch data from the local database;</li>
<li>the feed parser object can be totally reused (as it was before after the first refactoring step);</li>
<li><code>ZOCFeedParser</code> and <code>ZOCFeedParserDelegate</code> can be reused by other components;</li>
<li><code>ZOCViewController</code> (UI logic apart) can be reused;</li>
<li>it is easier to test as it’d be possible to use a mock object conforming to the expected protocol.</li>
</ul>
<p>When implementing a protocol you should always strive to adhere to the <a href="http://en.wikipedia.org/wiki/Liskov_substitution_principle" target="_blank" rel="noopener">Liskov Substitution Principle</a>. This principle states that you should be able to replace one implementation of an interface (“protocol” in the Objective-C lingo) with another without breaking either the client or the implementation.</p>
<p>In other words this means that your protocol should not leak the detail of the implementing classes; be even more careful when designing the abstraction expressed by you protocol and always keep in mind that the underlay implementation is irrelevant, what really matters is the contract that the abstraction expose to the consumer.</p>
<p>Everything that is designed to be reused in future is implicitly better code and should be always the programmer’s goal. Code designed this way is what makes the difference between an experienced programmer and a newbie.</p>
<p>The final code proposed here can be found <a href="http://github.com/albertodebortoli/ADBFeedReader" target="_blank" rel="noopener">here</a>.</p>
<h1 id="NSNotification"><a href="#NSNotification" class="headerlink" title="NSNotification"></a>NSNotification</h1><p>When you define your own <code>NSNotification</code> you should define your notification’s name as a string constant. Like any string constant that you want to make available to other classes, it should be declared as <code>extern</code> in the public interface, and defined privately in the corresponding implementation.<br>Because you’re exposing this symbol in the header you should follow the usual namespace rule prefixing the notification name with the class name that belongs to.<br>It’s also good practice to name the notification using the verb Did/Will and terminate the name with the word “Notifications”.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// Foo.h</span><br><span class="line">extern NSString * const ZOCFooDidBecomeBarNotification</span><br><span class="line"></span><br><span class="line">// Foo.m</span><br><span class="line">NSString * const ZOCFooDidBecomeBarNotification = @&quot;ZOCFooDidBecomeBarNotification&quot;;</span><br></pre></td></tr></table></figure>
<h1 id="Beautifying-the-code"><a href="#Beautifying-the-code" class="headerlink" title="Beautifying the code"></a>Beautifying the code</h1><h3 id="Spacing"><a href="#Spacing" class="headerlink" title="Spacing"></a>Spacing</h3><ul>
<li>Indent using 4 spaces. Never indent with tabs. Be sure to set this preference in Xcode.</li>
<li>Method braces and other braces (<code>if</code>/<code>else</code>/<code>switch</code>/<code>while</code> etc.) always open on the same line as the statement but close on a new line.</li>
</ul>
<p><strong>Preferred:</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">if (user.isHappy) &#123;</span><br><span class="line">    // Do something</span><br><span class="line">&#125;</span><br><span class="line">else &#123;</span><br><span class="line">    // Do something else</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><strong>Not Preferred:</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">if (user.isHappy)</span><br><span class="line">&#123;</span><br><span class="line">    // Do something</span><br><span class="line">&#125; else &#123;</span><br><span class="line">    // Do something else</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<ul>
<li>There should be exactly one blank line between methods to aid in visual clarity and organization. Whitespace within methods should separate functionality, but often there should probably be new methods.</li>
<li>Prefer using auto-synthesis. But if necessary, <code>@synthesize</code> and <code>@dynamic</code> should each be declared on new lines in the implementation.</li>
<li>Colon-aligning method invocation should often be avoided. There are cases where a method signature may have more than 3 colons and colon-aligning makes the code more readable. Always colon align methods, even if they contain blocks.</li>
</ul>
<p><strong>Preferred:</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[UIView animateWithDuration:1.0</span><br><span class="line">                 animations:^&#123;</span><br><span class="line">                     // something</span><br><span class="line">                 &#125;</span><br><span class="line">                 completion:^(BOOL finished) &#123;</span><br><span class="line">                     // something</span><br><span class="line">                 &#125;];</span><br></pre></td></tr></table></figure>
<p><strong>Not Preferred:</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[UIView animateWithDuration:1.0 animations:^&#123;</span><br><span class="line">    // something </span><br><span class="line">&#125; completion:^(BOOL finished) &#123;</span><br><span class="line">    // something</span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure>
<p>If auto indentation falls into bad readability, declare blocks in variables before or reconsider your method signature.</p>
<h3 id="Line-Breaks"><a href="#Line-Breaks" class="headerlink" title="Line Breaks"></a>Line Breaks</h3><p>Line breaks are an important topic since this style guide is focused for print and online readability.</p>
<p>For example:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">self.productsRequest = [[SKProductsRequest alloc] initWithProductIdentifiers:productIdentifiers];</span><br></pre></td></tr></table></figure></p>
<p>A long line of code like the one above should be carried on to the second line adhering to this style guide’s Spacing section (two spaces).</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">self.productsRequest = [[SKProductsRequest alloc] </span><br><span class="line">  initWithProductIdentifiers:productIdentifiers];</span><br></pre></td></tr></table></figure>
<h3 id="Brackets"><a href="#Brackets" class="headerlink" title="Brackets"></a>Brackets</h3><p>Use <a href="https://en.wikipedia.org/wiki/Indent_style#K.26R_style" target="_blank" rel="noopener">Egyptian brackets</a> for:</p>
<ul>
<li>control structures (if-else, for, switch)</li>
</ul>
<p>Non-Egyptian brackets are accepted for:</p>
<ul>
<li>class implementations (if any)</li>
<li>method implementations</li>
</ul>
<h1 id="Code-Organization"><a href="#Code-Organization" class="headerlink" title="Code Organization"></a>Code Organization</h1><p><a href="http://nshipster.com/pragma/" target="_blank" rel="noopener">Quoting</a> Mattt Thompson</p>
<blockquote>
<p>code organization is a matter of hygiene</p>
</blockquote>
<p>We could not agree more. Having you code clearly organized in a clean and defined manner is a way to show respect for yourself and other people that will read and change you code (consider the future you included).</p>
<h2 id="Exploit-Code-Block"><a href="#Exploit-Code-Block" class="headerlink" title="Exploit Code Block"></a>Exploit Code Block</h2><p>A very obscure GCC behavior that it is also supported by Clang is the ability of a code block to return the value of the latest statement if enclosing in round bracket.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">NSURL *url = (&#123;</span><br><span class="line">    NSString *urlString = [NSString stringWithFormat:@&quot;%@/%@&quot;, baseURLString, endpoint];</span><br><span class="line">    [NSURL URLWithString:urlString];</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>This feature can be nicely organized to group small chunk of code that usually are necessary only for the sole purpose of setting up a class.<br>This gives a reader an important visual clue and help reduce the visual noise focusing on the most important variable in the function.<br>Additionally, this technique has the advantage that all the variables declared inside the code block, as one might expect, are valid only inside that scope, this mean that the your not polluting the method’s stack trace and you can reuse the variable name without having duplicated symbols.</p>
<h2 id="Pragma"><a href="#Pragma" class="headerlink" title="Pragma"></a>Pragma</h2><h3 id="Pragma-Mark"><a href="#Pragma-Mark" class="headerlink" title="Pragma Mark"></a>Pragma Mark</h3><p><code>#pragma mark -</code> is a great way to organize the code inside a class and helps you grouping methods implementation.<br>We suggest to use <code>#pragma mark -</code>to separate:</p>
<ul>
<li>methods in functional groupings </li>
<li>protocols implementations.</li>
<li>methods overridden from a superclass</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- (void)dealloc &#123; /* ... */ &#125;</span><br><span class="line">- (instancetype)init &#123; /* ... */ &#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - View Lifecycle</span><br><span class="line"></span><br><span class="line">- (void)viewDidLoad &#123; /* ... */ &#125;</span><br><span class="line">- (void)viewWillAppear:(BOOL)animated &#123; /* ... */ &#125;</span><br><span class="line">- (void)didReceiveMemoryWarning &#123; /* ... */ &#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - Custom Accessors</span><br><span class="line"></span><br><span class="line">- (void)setCustomProperty:(id)value &#123; /* ... */ &#125;</span><br><span class="line">- (id)customProperty &#123; /* ... */ &#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - IBActions</span><br><span class="line"></span><br><span class="line">- (IBAction)submitData:(id)sender &#123; /* ... */ &#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - Public</span><br><span class="line"></span><br><span class="line">- (void)publicMethod &#123; /* ... */ &#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - Private</span><br><span class="line"></span><br><span class="line">- (void)zoc_privateMethod &#123; /* ... */ &#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - UITableViewDataSource</span><br><span class="line"></span><br><span class="line">- (UITableViewCell *)tableView:(UITableView *)tableView cellForRowAtIndexPath:(NSIndexPath *)indexPath &#123; /* ... */ &#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - ZOCSuperclass</span><br><span class="line"></span><br><span class="line">// ... overridden methods from ZOCSuperclass</span><br><span class="line"></span><br><span class="line">#pragma mark - NSObject</span><br><span class="line"></span><br><span class="line">- (NSString *)description &#123; /* ... */ &#125;</span><br></pre></td></tr></table></figure>
<p>The above marks will help to visually separate and organize the code. One of the pros is that you can cmd+click on the mark to jump to the symbol definition.<br>Be aware that even though the use of pragma mark is a sign of craftsmanship, it’s not a good reason to make grow the number of methods in your class in a unbounded fashion: having too many of them should be a warning sign that your class has too many responsibilities and a good opportunity for refactoring.</p>
<h3 id="Notes-about-pragma"><a href="#Notes-about-pragma" class="headerlink" title="Notes about pragma"></a>Notes about pragma</h3><p>At <a href="http://raptureinvenice.com/pragmas-arent-just-for-marks" target="_blank" rel="noopener">http://raptureinvenice.com/pragmas-arent-just-for-marks</a> there’s a great discussion about pragmas, reported in part here.</p>
<p>While most iOS developers don’t play around much with compiler options, some options are useful to control how strictly to check (or not check) your code for errors. Sometimes, though, you want to make an exception directly in your code using a pragma, which purpose is to temporarily disable a compiler behavior.</p>
<p>When you use ARC, the compiler inserts memory-management calls for you. There are cases, though, where it can get confused. One such case is when you use <code>NSSelectorFromString</code> to have a dynamically-named selector called. Since ARC can’t know what the method will be and what kind of memory management to use, you’ll be warned with <code>performSelector may cause a leak because its selector is unknown</code>.</p>
<p>If you know your code won’t leak, you can suppress the warning for just this instance by wrapping it like this:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#pragma clang diagnostic push</span><br><span class="line">#pragma clang diagnostic ignored &quot;-Warc-performSelector-leaks&quot;</span><br><span class="line"></span><br><span class="line">[myObj performSelector:mySelector withObject:name];</span><br><span class="line"></span><br><span class="line">#pragma clang diagnostic pop</span><br></pre></td></tr></table></figure>
<p>Note how we disable the -Warc-performSelector-leaks check by pushing and popping the change around our code. This assures us we don’t disable it globally, which would be a huge mistake.</p>
<p>The entire list of options that can be enable or disabled can be found at <a href="http://clang.llvm.org/docs/UsersManual.html" target="_blank" rel="noopener">The Clang User’s Manual</a> to learn about all of them.</p>
<p>Suppressing warnings for unused variables</p>
<p>It’s useful to be told that a variable you’ve defined is going unused. In most cases, you want to remove these references to improve performance (however slightly), but sometimes you want to keep them. Why? Perhaps they have a future usage or the functionality is only temporarily removed. Either way, a smarter way to suppress the warning without brutally commenting out the relevant lines, is to use the <code>#pragma unused()</code>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">- (NSUInteger)giveMeFive &#123;</span><br><span class="line">    NSString *foo;</span><br><span class="line">    #pragma unused (foo)</span><br><span class="line"></span><br><span class="line">    return 5;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Now you can keep your code in place without the compiler complaining about it. And yes, that pragma needs to go below the offending code.</p>
<h2 id="Explicit-warnings-and-errors"><a href="#Explicit-warnings-and-errors" class="headerlink" title="Explicit warnings and errors"></a>Explicit warnings and errors</h2><p>The compiler is a robot: it will mark what’s wrong with your code using a set of rules that’ve been defined by Clang. But, every so often you’re smarter than it. Often, you might find some offending code that you know will lead to problems but, for whatever reason, can’t fix yourself at the moment. You can explicitly signal errors like this:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">- (NSInteger)divide:(NSInteger)dividend by:(NSInteger)divisor &#123;</span><br><span class="line">    #error Whoa, buddy, you need to check for zero here!</span><br><span class="line">    return (dividend / divisor);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>You can signal warnings similarly:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">- (float)divide:(float)dividend by:(float)divisor &#123;</span><br><span class="line">    #warning Dude, don&apos;t compare floating point numbers like this!</span><br><span class="line">    if (divisor != 0.0) &#123;</span><br><span class="line">        return (dividend / divisor);</span><br><span class="line">    &#125;</span><br><span class="line">    else &#123;</span><br><span class="line">        return NAN;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Docstrings"><a href="#Docstrings" class="headerlink" title="Docstrings"></a>Docstrings</h2><p>All non-trivial methods, interfaces, categories, and protocol declarations should have accompanying comments describing their purpose and how they fit into the larger picture. For more examples, see the Google Style Guide around <a href="http://google-styleguide.googlecode.com/svn/trunk/objcguide.xml#File_Comments" target="_blank" rel="noopener">File and Declaration Comments</a>.</p>
<p>To summarize: There are two types of docstrings, long-form and short-form.</p>
<p>A short-form docstring fits entirely on one line, including the comment slashes. It is used for simple functions, especially (though by no means exclusively) ones that are not part of a public API:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">// Return a user-readable form of a Frobnozz, html-escaped.</span><br></pre></td></tr></table></figure>
<p>Note that the text is specified as an action (“return”) rather than a description (“returns”).</p>
<p>If the description spills past one line, you should move to the long-form docstring: a summary line (one physical line) preceded by an opening block comment with two asterisks on a line of its own (/**, terminated by a period, question mark, or exclamation point, followed by a blank line, followed by the rest of the doc string starting at the same cursor position as the first quote of the first line, ending with an end-block comment (*/) on a line by itself.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> This comment serves to demonstrate the format of a docstring.</span><br><span class="line"></span><br><span class="line"> Note that the summary line is always at most one line long, and</span><br><span class="line"> after the opening block comment, and each line of text is preceded</span><br><span class="line"> by a single space.</span><br><span class="line">*/</span><br></pre></td></tr></table></figure>
<p>A function must have a docstring unless it meets all of the following criteria:</p>
<ul>
<li>not externally visible</li>
<li>very short</li>
<li>obvious</li>
</ul>
<p>The docstring should describe the function’s calling syntax and its semantics, not its implementation.</p>
<h2 id="Comments"><a href="#Comments" class="headerlink" title="Comments"></a>Comments</h2><p>When they are needed, comments should be used to explain why a particular piece of code does something. Any comments that are used must be kept up-to-date or deleted.</p>
<p>Block comments should generally be avoided, as code should be as self-documenting as possible, with only the need for intermittent, few-line explanations. <em>Exception: This does not apply to those comments used to generate documentation.</em></p>
<h3 id="Header-Documentation"><a href="#Header-Documentation" class="headerlink" title="Header Documentation"></a>Header Documentation</h3><p>The documentation of class should be done using the Doxygen/AppleDoc syntax only in the .h files when possible. Documentation should be provided for methods and properties.</p>
<p><strong>For example:</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> *  Designated initializer.</span><br><span class="line"> *</span><br><span class="line"> *  @param  store  The store for CRUD operations.</span><br><span class="line"> *  @param  searchService The search service used to query the store.</span><br><span class="line"> *</span><br><span class="line"> *  @return A ZOCCRUDOperationsStore object.</span><br><span class="line"> */</span><br><span class="line">- (instancetype)initWithOperationsStore:(id&lt;ZOCGenericStoreProtocol&gt;)store</span><br><span class="line">                          searchService:(id&lt;ZOCGenericSearchServiceProtocol&gt;)searchService;</span><br></pre></td></tr></table></figure>
<h1 id="Inter-Object-Communication"><a href="#Inter-Object-Communication" class="headerlink" title="Inter-Object Communication"></a>Inter-Object Communication</h1><p>Every non-trivial software is based on objects that need to communicate with each other to meet complex goals. This chapter is about design concepts going first into deep explanations on how the armory will achieve great architectures works and how it should be used.</p>
<h2 id="Blocks"><a href="#Blocks" class="headerlink" title="Blocks"></a>Blocks</h2><p>Blocks are the Objective-C version of well-knows constructs called lambdas or closures available in other languages for many years now.</p>
<p>They are a great way to design asynchronous APIs as so:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">- (void)downloadObjectsAtPath:(NSString *)path</span><br><span class="line">                   completion:(void(^)(NSArray *objects, NSError *error))completion;</span><br></pre></td></tr></table></figure>
<p>When designing something like the above, try to declare functions and methods to take no more than one block and always make the blocks be the last arguments. It is a good approach to try to combine data and error in one block instead of two separate blocks (usually one for the success and one for the failure).</p>
<p>You should do this because:</p>
<ul>
<li>Usually there are part of code that are shared between them (i.e. dismiss a progress or an activity indicator);</li>
<li>Apple is doing the same, and it is always good to be consistent with the platform;</li>
<li>Since Blocks are typically multiple lines of code, having the block be other than the last argument would break up the call site<a href="https://github.com/NYTimes/objective-c-style-guide/issues/6)" target="_blank" rel="noopener">1</a>;</li>
<li>Taking more than one block as arguments would make the call site potentially unwieldy in length. It also introduces complexity<a href="https://github.com/NYTimes/objective-c-style-guide/issues/6)" target="_blank" rel="noopener">1</a>.</li>
</ul>
<p>Consider the above method, the signature of the completion block is very common: the first parameter regards the data the caller is interested in, the second parameter is the error encountered. The contract should be therefore as follow:</p>
<ul>
<li>if <code>objects</code> is not nil, then <code>error</code> must be nil</li>
<li>if <code>objects</code> is nil, then <code>error</code> must not be nil</li>
</ul>
<p>as the caller of this method is first interested in the actual data, an implementation like so is preferred:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">- (void)downloadObjectsAtPath:(NSString *)path</span><br><span class="line">                   completion:(void(^)(NSArray *objects, NSError *error))completion &#123;</span><br><span class="line">    if (objects) &#123;</span><br><span class="line">        // do something with the data</span><br><span class="line">    &#125;</span><br><span class="line">    else &#123;</span><br><span class="line">        // some error occurred, &apos;error&apos; variable should not be nil by contract</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Moreover, as for synchronous methods, some of Apple’s APIs write garbage values to the error parameter (if non-NULL) in successful cases, so checking the error can cause false positives.</p>
<h3 id="Under-the-Hood"><a href="#Under-the-Hood" class="headerlink" title="Under the Hood"></a>Under the Hood</h3><p>Some key points:</p>
<ul>
<li>Blocks are created on the stack</li>
<li>Blocks can be copied to the heap</li>
<li>Blocks have their own private const copies of stack variables (and pointers)</li>
<li>Mutable stack variables and pointers must be declared with the __block keyword</li>
</ul>
<p>If blocks aren’t kept around anywhere, will remain on the stack and will go away when their stack frame returns. While on the stack, a block has no effect on the storage or lifetime of anything it accesses. If blocks need to exist after the stack frame returns, they can be copied to the heap and this action is an explicit operation. This way, a block will gain reference-counting as all objects in Cocoa. When they are copied, they take their captured scope with them, retaining any objects they refer. If a block references a stack variable or pointer, then when the block is initialized it is given its own copy of that variable declared const, so assignments won’t work. When a block is copied, the <code>__block</code> stack variables it reference are copied to the heap and after the copy operation both block on the stack and brand new block on the heap refer to the variables on the heap.</p>
<p>LLDB shows that a block is a nice piece of things.</p>
<p><img src="/2018/11/13/禅与Objective-C编程艺术英文版/blocks_debugger.png" alt=""></p>
<p>The most important thing to note is that <code>__block</code> variables and pointers are treated inside the block as structs that obviously handle the reference to the real value/object.</p>
<p>Blocks are first-class citizens in the Objective-C runtime: they have an <code>isa</code> pointer which defines a class through which the Objective-C runtime can access methods and storage. In a non-ARC environment you can mess things up for sure, and cause crashes due to dangling pointers. <code>__block</code> applies only when using the variables in the block, it simply says to the block:</p>
<blockquote>
<p>Hey, this pointer or primitive type relies on the stack with its own address. Please refer to this little friend with a new variable on the stack. I mean… refer to the object with double dereference, and don’t retain it.<br>Thank you, sir.</p>
</blockquote>
<p>If at some time after the declaration but before the invocation of the block, the object has been released and deallocated, the execution of the block will cause a crash. <code>__block</code> variables are not retained within the block. In the deep end… it’s all about pointers, references, dereferences and retain count stuff.</p>
<h3 id="Retain-cycles-on-self"><a href="#Retain-cycles-on-self" class="headerlink" title="Retain cycles on self"></a>Retain cycles on self</h3><p>It’s important not to get into retain cycles when using blocks and asynchronous dispatches. Always set a <code>weak</code> reference to any variable that could cause a retain cycle. Moreover, it is a good practice to nil the properties holding the blocks (i.e. <code>self.completionBlock = nil</code>) this will break potential retain cycle introduced by the block capturing the scope. </p>
<p><strong>Example:</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">__weak __typeof(self) weakSelf = self;</span><br><span class="line">[self executeBlock:^(NSData *data, NSError *error) &#123;</span><br><span class="line">    [weakSelf doSomethingWithData:data];</span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure>
<p><strong>Not:</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[self executeBlock:^(NSData *data, NSError *error) &#123;</span><br><span class="line">    [self doSomethingWithData:data];</span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure>
<p><strong>Example with multiple statements:</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">__weak __typeof(self)weakSelf = self;</span><br><span class="line">[self executeBlock:^(NSData *data, NSError *error) &#123;</span><br><span class="line">    __strong __typeof(weakSelf) strongSelf = weakSelf;</span><br><span class="line">    if (strongSelf) &#123;</span><br><span class="line">        [strongSelf doSomethingWithData:data];</span><br><span class="line">        [strongSelf doSomethingWithData:data];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure>
<p><strong>Not:</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">__weak __typeof(self)weakSelf = self;</span><br><span class="line">[self executeBlock:^(NSData *data, NSError *error) &#123;</span><br><span class="line">    [weakSelf doSomethingWithData:data];</span><br><span class="line">    [weakSelf doSomethingWithData:data];</span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure>
<p>You should add these two lines as snippets to Xcode and always use them exactly like this:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">__weak __typeof(self)weakSelf = self;</span><br><span class="line">__strong __typeof(weakSelf)strongSelf = weakSelf;</span><br></pre></td></tr></table></figure>
<p>Here we dig further about the subtle things to consider about the <code>__weak</code> and the <code>__strong</code> qualifiers for self inside blocks. To summarize, we can refer to self in three different ways inside a block:</p>
<ol>
<li>using the keyword <code>self</code> directly inside the block</li>
<li>declaring a <code>__weak</code> reference to self outside the block and referring to the object via this weak reference inside the block</li>
<li>declaring a <code>__weak</code> reference to self outside the block and creating a <code>__strong</code> reference to self using the weak reference inside the block</li>
</ol>
<p><strong>Case 1: using the keyword <code>self</code> inside a block</strong></p>
<p>If we use directly the keyword <code>self</code> inside a block, the object is retained at block declaration time within the block (actually when the block is <a href="https://developer.apple.com/library/ios/documentation/cocoa/conceptual/Blocks/Articles/bxVariables.html#//apple_ref/doc/uid/TP40007502-CH6-SW4" target="_blank" rel="noopener">copied</a> but for sake of simplicity we can forget about it) . A const reference to self has its place inside the block and this affects the reference counting of the object. If the block is used by other classes and/or passed around we may want to retain self as well as all the other objects used by the block since they are <em>needed</em> for the execution of the block. </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">dispatch_block_t completionBlock = ^&#123;</span><br><span class="line">    NSLog(@&quot;%@&quot;, self);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">MyViewController *myController = [[MyViewController alloc] init...];</span><br><span class="line">[self presentViewController:myController</span><br><span class="line">                   animated:YES</span><br><span class="line">                 completion:completionHandler];</span><br></pre></td></tr></table></figure>
<p>No big deal. But… what if the block is retained by self in a property (as the following example) and therefore the object (self) retains the block?</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">self.completionHandler = ^&#123;</span><br><span class="line">    NSLog(@&quot;%@&quot;, self);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">MyViewController *myController = [[MyViewController alloc] init...];</span><br><span class="line">[self presentViewController:myController</span><br><span class="line">                   animated:YES</span><br><span class="line">                 completion:self.completionHandler];</span><br></pre></td></tr></table></figure>
<p>This is what is well known as a retain cycle and retain cycles usually should be avoided. The warning we receive from CLANG is:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Capturing &apos;self&apos; strongly in this block is likely to lead to a retain cycle</span><br></pre></td></tr></table></figure>
<p>Here comes in the <code>__weak</code> qualifier.</p>
<p><strong>Case 2: declaring a <code>__weak</code> reference to self outside the block and use it inside the block</strong></p>
<p>Declaring a <code>__weak</code> reference to self outside the block and referring to it via this weak reference inside the block avoids retain cycles. This is what we usually want to do if the block is already retained by self in a property.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">__weak typeof(self) weakSelf = self;</span><br><span class="line">self.completionHandler = ^&#123;</span><br><span class="line">    NSLog(@&quot;%@&quot;, weakSelf);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">MyViewController *myController = [[MyViewController alloc] init...];</span><br><span class="line">[self presentViewController:myController</span><br><span class="line">                   animated:YES</span><br><span class="line">                 completion:self.completionHandler];</span><br></pre></td></tr></table></figure>
<p>In this example the block does not retain the object and the object retains the block in a property. Cool. We are sure that we can refer to self safely, at worst, it is nilled out by someone. The question is: how is it possible for self to be “destroyed” (deallocated) within the scope of a block?</p>
<p>Consider the case of a block being copied from an object to another (let’s say myController) as a result of the assignment of a property. The former object is then released before the copied block has had a chance to execute.</p>
<p>The next step is interesting.</p>
<p><strong>Case 3: declaring a <code>__weak</code> reference to self outside the block and use a <code>__strong</code> reference inside the block</strong></p>
<p>You may think, at first, this is a trick to use self inside the block avoiding the retain cycle warning. This is not the case. The strong reference to self is created at <em>block execution time</em> while using self in the block is evaluated at <em>block declaration time</em>, thus retaining the object.</p>
<p><a href="http://developer.apple.com/library/mac/#releasenotes/ObjectiveC/RN-TransitioningToARC/Introduction/Introduction.html" target="_blank" rel="noopener">Apple documentation</a> reports that “For non-trivial cycles, however, you should use” this approach: </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">MyViewController *myController = [[MyViewController alloc] init...];</span><br><span class="line">// ...</span><br><span class="line">MyViewController * __weak weakMyController = myController;</span><br><span class="line">myController.completionHandler = ^(NSInteger result) &#123;</span><br><span class="line">    MyViewController *strongMyController = weakMyController;</span><br><span class="line">    if (strongMyController) &#123;</span><br><span class="line">        // ...</span><br><span class="line">        [strongMyController dismissViewControllerAnimated:YES completion:nil];</span><br><span class="line">        // ...</span><br><span class="line">    &#125;</span><br><span class="line">    else &#123;</span><br><span class="line">        // Probably nothing...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>First of all, this example looks wrong to me. How can self be deallocated and be nilled out if the block itself is retained in the <code>completionHandler</code> property? The <code>completionHandler</code> property can be declared as <code>assign</code> or <code>unsafe_unretained</code> to allow the object to be deallocated after the block is passed around.<br>I can’t see the reason for doing that. If other objects need the object (self), the block that is passed around should retain the object and therefore the block should not be assigned to a property. No <code>__weak</code>/<code>__strong</code> usage should be involved in this case.</p>
<p>Anyway, in other cases it is possible for weakSelf to become nil just like the second case explained (declaring a weak reference outside the block and use it inside). </p>
<p>Moreover, what is the meaning of “trivial block” for Apple? It is my understanding that a trivial block is a block that is not passed around, it’s used within a well defined and controlled scope and therefore the usage of the weak qualifier is just to avoid a retain cycle.</p>
<p>As <a href="http://dhoerl.wordpress.com/2013/04/23/i-finally-figured-out-weakself-and-strongself/" target="_blank" rel="noopener">a</a> <a href="http://blog.random-ideas.net/?p=160" target="_blank" rel="noopener">lot</a> <a href="http://stackoverflow.com/questions/7904568/disappearing-reference-to-self-in-a-block-under-arc" target="_blank" rel="noopener">of</a> <a href="http://stackoverflow.com/questions/12218767/objective-c-blocks-and-memory-management" target="_blank" rel="noopener">online</a> <a href="https://github.com/AFNetworking/AFNetworking/issues/807" target="_blank" rel="noopener">references</a>, books (<a href="http://www.effectiveobjectivec.com/" target="_blank" rel="noopener">Effective Objective-C 2.0</a> by <a href="https://twitter.com/mattjgalloway" target="_blank" rel="noopener">Matt Galloway</a> and <a href="http://www.amazon.it/Pro-Multithreading-Memory-Management-Ios/dp/1430241160" target="_blank" rel="noopener">Pro Multithreading and Memory Management for iOS and OS X</a> by Kazuki Sakamoto &amp; Tomohiko Furumoto) discuss this edge case, the topic is not well understood yet by the majority of the developers.</p>
<p>The real benefit of using the strong reference inside of a block is to be robust to preemption. Going again through the above 3 cases, during the execution of a block:</p>
<p><strong>Case 1: using the keyword <code>self</code> inside a block</strong></p>
<p>If the block is retained by a property, a retain cycle is created between self and the block and both objects can’t be destroyed anymore. If the block is passed around and copied by others, self is retained for each copy.</p>
<p><strong>Case 2: declaring a <code>__weak</code> reference to self outside the block and use it inside the block</strong></p>
<p>There is no retain cycle and no matter if the block is retained or not by a property. If the block is passed around and copied by others, when executed, weakSelf can have been turned nil.<br>The execution of the block can be preempted and different subsequent evaluations of the weakSelf pointer can lead to different values (i.e. weakSelf can become nil at a certain evaluation).</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">__weak typeof(self) weakSelf = self;</span><br><span class="line">dispatch_block_t block = ^&#123;</span><br><span class="line">    [weakSelf doSomething]; // weakSelf != nil</span><br><span class="line">    // preemption, weakSelf turned nil</span><br><span class="line">    [weakSelf doSomethingElse]; // weakSelf == nil</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p><strong>Case 3: declaring a <code>__weak</code> reference to self outside the block and use a <code>__strong</code> reference inside the block</strong></p>
<p>There is no retain cycle and, again, no matter if the block is retained or not by a property. If the block is passed around and copied by others, when executed, <code>weakSelf</code> can have been turned nil. When the strong reference is assigned and it is not nil, we are sure that the object is retained for the entire execution of the block if preemption occurs and therefore subsequent evaluations of strongSelf will be consistent and will lead to the same value since the object is now retained. If strongSelf evaluates to nil usually the execution is returned since the block cannot execute properly.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">__weak typeof(self) weakSelf = self;</span><br><span class="line">myObj.myBlock = ^&#123;</span><br><span class="line">    __strong typeof(self) strongSelf = weakSelf;</span><br><span class="line">    if (strongSelf) &#123;</span><br><span class="line">        [strongSelf doSomething]; // strongSelf != nil</span><br><span class="line">        // preemption, strongSelf still not nil</span><br><span class="line">        [strongSelf doSomethingElse]; // strongSelf != nil</span><br><span class="line">    &#125;</span><br><span class="line">    else &#123;</span><br><span class="line">        // Probably nothing...</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>In an ARC-based environment, the compiler itself alerts us with an error if trying to access an instance variable using the <code>-&gt;</code> notation. The error is very clear:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Dereferencing a __weak pointer is not allowed due to possible null value caused by race condition, assign it to a strong variable first.</span><br></pre></td></tr></table></figure>
<p>It can be shown with the following code:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">__weak typeof(self) weakSelf = self;</span><br><span class="line">myObj.myBlock = ^&#123;</span><br><span class="line">    id localVal = weakSelf-&gt;someIVar;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>In the very end:</p>
<ul>
<li><p><strong>Case 1</strong>: should be used only when the block is not assigned to a property, otherwise it will lead to a retain cycle.</p>
</li>
<li><p><strong>Case 2</strong>: should be used when the block is assigned to a property.</p>
</li>
<li><p><strong>Case 3</strong>: it is related to concurrent executions. When asynchronous services are involved, the blocks that are passed to them can be executed at a later period and there is no certainty about the existence of the self object.</p>
</li>
</ul>
<h2 id="Delegate-and-DataSource"><a href="#Delegate-and-DataSource" class="headerlink" title="Delegate and DataSource"></a>Delegate and DataSource</h2><p>Delegation is a widespread pattern throughout Apple’s frameworks and it is one of the most important patterns in the Gang of Four’s book “Design Patterns”. The delegation pattern is unidirectional, the message sender (the delegant) needs to know about the recipient (the delegate), but not the other way around. The coupling between the objects is loosen the sender only knows that its delegate conforms to a specific protocol.</p>
<p>In its pure form, delegation is about providing callbacks to the delegate, which means that the delegate implements a set of methods with void return type.</p>
<p>Unfortunately this has not been respected over years by the APIs from Apple and therefore developers acted imitating this misleading approach. A classic example is the <a href="https://developer.apple.com/library/ios/documentation/uikit/reference/UITableViewDelegate_Protocol/Reference/Reference.html" target="_blank" rel="noopener">UITableViewDelegate</a> protocol.</p>
<p>While some methods have void return type and look like callbacks:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">- (void)tableView:(UITableView *)tableView didSelectRowAtIndexPath:(NSIndexPath *)indexPath;</span><br><span class="line">- (void)tableView:(UITableView *)tableView didHighlightRowAtIndexPath:(NSIndexPath *)indexPath;</span><br></pre></td></tr></table></figure>
<p>others are definitely not:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">- (CGFloat)tableView:(UITableView *)tableView heightForRowAtIndexPath:(NSIndexPath *)indexPath;</span><br><span class="line">- (BOOL)tableView:(UITableView *)tableView canPerformAction:(SEL)action forRowAtIndexPath:(NSIndexPath *)indexPath withSender:(id)sender;</span><br></pre></td></tr></table></figure>
<p>When the delegant asks for some kind of information to the delegate object, the direction implied is from the delegate to the delegant and to the other way around anymore. This is conceptually different and a new name should be use to describe the pattern: DataSource.</p>
<p>One could argue that Apple has a <a href="https://developer.apple.com/library/ios/documentation/uikit/reference/UITableViewDataSource_Protocol/Reference/Reference.html" target="_blank" rel="noopener">UITableViewDataSouce</a> protocol for it (forced under the name of the delegate pattern) but in reality it is used for methods providing information about how the real data should be presented.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">- (UITableViewCell *)tableView:(UITableView *)tableView cellForRowAtIndexPath:(NSIndexPath *)indexPath;</span><br><span class="line">- (NSInteger)numberOfSectionsInTableView:(UITableView *)tableView;</span><br></pre></td></tr></table></figure>
<p>Moreover, in the above 2 methods Apple mixed the presentation layer with the data layer which is clearly ugly and in the end very few developers felt bad about it over times and even here we’ll call delegate methods both methods with void return type and not void for simplicity.</p>
<p>To split the concepts, the following approach should be used:</p>
<ul>
<li>delegate pattern: when the delegant needs to notify the delegate about event occurred</li>
<li>datasource pattern: when the delegant needs to fetch information from the datasource object</li>
</ul>
<p>Here is a concrete example:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">@class ZOCSignUpViewController;</span><br><span class="line"></span><br><span class="line">@protocol ZOCSignUpViewControllerDelegate &lt;NSObject&gt;</span><br><span class="line">- (void)signUpViewControllerDidPressSignUpButton:(ZOCSignUpViewController *)controller;</span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@protocol ZOCSignUpViewControllerDataSource &lt;NSObject&gt;</span><br><span class="line">- (ZOCUserCredentials *)credentialsForSignUpViewController:(ZOCSignUpViewController *)controller;</span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@protocol ZOCSignUpViewControllerDataSource &lt;NSObject&gt;</span><br><span class="line"></span><br><span class="line">@interface ZOCSignUpViewController : UIViewController</span><br><span class="line"></span><br><span class="line">@property (nonatomic, weak) id&lt;ZOCSignUpViewControllerDelegate&gt; delegate;</span><br><span class="line">@property (nonatomic, weak) id&lt;ZOCSignUpViewControllerDataSource&gt; dataSource;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<p>Delegate methods should be always have the caller as first parameter as in the above example otherwise delegate objects could not be able to distinguish between different instances of delegants. In other words, if the caller is not passed to the delegate object, there would be no way for any delegate to deal with 2 delegant object. So, following is close to blasphemy:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- (void)calculatorDidCalculateValue:(CGFloat)value;</span><br></pre></td></tr></table></figure>
<p>By default, methods in protocols are required to be implemented by delegate objects. It is possible to mark some of them as optional and to be explicit about the required method using the <code>@required</code> and <code>@optional</code> keywords as so: </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">@protocol ZOCSignUpViewControllerDelegate &lt;NSObject&gt;</span><br><span class="line">@required</span><br><span class="line">- (void)signUpViewController:(ZOCSignUpViewController *)controller didProvideSignUpInfo:(NSDictionary *);</span><br><span class="line">@optional</span><br><span class="line">- (void)signUpViewControllerDidPressSignUpButton:(ZOCSignUpViewController *)controller;</span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<p>For optional methods, the delegant must check if the delegate actually implements a specific method before sending the message to it (otherwise a crash would occur) as so:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">if ([self.delegate respondsToSelector:@selector(signUpViewControllerDidPressSignUpButton:)]) &#123;</span><br><span class="line">    [self.delegate signUpViewControllerDidPressSignUpButton:self];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Inheritance"><a href="#Inheritance" class="headerlink" title="Inheritance"></a>Inheritance</h3><p>Sometimes you may need to override delegate methods. Consider the case of having two UIViewController subclasses: UIViewControllerA and UIViewControllerB, with the following class hierarchy.</p>
<p><code>UIViewControllerB &lt; UIViewControllerA &lt; UIViewController</code></p>
<p><code>UIViewControllerA</code> conforms to <code>UITableViewDelegate</code> and implements <code>- (CGFloat)tableView:(UITableView *)tableView heightForRowAtIndexPath:(NSIndexPath *)indexPath</code>.</p>
<p>You want to provide a different implementation for the method above in <code>UIViewControllerB</code>. An implementation like the following will work:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- (CGFloat)tableView:(UITableView *)tableView heightForRowAtIndexPath:(NSIndexPath *)indexPath &#123;</span><br><span class="line">    CGFloat retVal = 0;</span><br><span class="line">    if ([super respondsToSelector:@selector(tableView:heightForRowAtIndexPath:)]) &#123;</span><br><span class="line">        retVal = [super tableView:self.tableView heightForRowAtIndexPath:indexPath];</span><br><span class="line">    &#125;</span><br><span class="line">    return retVal + 10.0f;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>But what if the given method was not implemented in the superclass (<code>UIViewControllerA</code>)?</p>
<p>The invocation</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[super respondsToSelector:@selector(tableView:heightForRowAtIndexPath:)]</span><br></pre></td></tr></table></figure>
<p>will use the NSObject’s implementation that will lookup, under the hood, in the context of <code>self</code> and clearly self implements the method but the app will crash at the next line with the following error:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">*** Terminating app due to uncaught exception &apos;NSInvalidArgumentException&apos;, reason: &apos;-[UIViewControllerB tableView:heightForRowAtIndexPath:]: unrecognized selector sent to instance 0x8d82820&apos;</span><br></pre></td></tr></table></figure>
<p>In this case we need to ask if instances of a specific class can respond to a given selector. The following code would do the trick:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- (CGFloat)tableView:(UITableView *)tableView heightForRowAtIndexPath:(NSIndexPath *)indexPath &#123;</span><br><span class="line">    CGFloat retVal = 0;</span><br><span class="line">    if ([[UIViewControllerA class] instancesRespondToSelector:@selector(tableView:heightForRowAtIndexPath:)]) &#123;</span><br><span class="line">        retVal = [super tableView:self.tableView heightForRowAtIndexPath:indexPath];</span><br><span class="line">    &#125;</span><br><span class="line">    return retVal + 10.0f;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>As code as the one above is ugly, often it’d be better to design the architecture in a way that delegate methods don’t need to be overridden.</p>
<h3 id="Multiple-Delegation"><a href="#Multiple-Delegation" class="headerlink" title="Multiple Delegation"></a>Multiple Delegation</h3><p>Multiple delegation is a very fundamental concept that, unfortunately, the majority of developers are hardly familiar with and too often NSNotifications are used instead. As you may have noticed, delegation and datasource are inter-object communication pattern involving only 2 objects: 1 delegant and 1 delegate.</p>
<p>DataSource pattern is forced to be 1 to 1 as the information the sender asks for can be provided by one and only one object. Things are different for the delegate pattern and it would be perfectly reasonable to have many delegate objects waiting for the callbacks.</p>
<p>There are cases where at least 2 objects are interested in receiving the callbacks from a particular delegant and the latter wants to know all of its delegates. This approach maps better a distributed system and more generically how complex flows of information usually go in wide software.</p>
<p>Multiple delegation can be achieved in many ways and the reader is dared to find a proper personal implementation. A very neat implementation of multiple delegation using the forward mechanism is given by Luca Bernardi in his <a href="https://github.com/lukabernardi/LBDelegateMatrioska" target="_blank" rel="noopener">LBDelegateMatrioska</a>.</p>
<p>A basic implementation is given here to unfold the concept. Even if in Cocoa there are ways to store weak references in a data structure to avoid retain cycles, here we use a class to hold a weak reference to the delegate object as single delegation does.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">@interface ZOCWeakObject : NSObject</span><br><span class="line"></span><br><span class="line">@property (nonatomic, weak, readonly) id object;</span><br><span class="line"></span><br><span class="line">+ (instancetype)weakObjectWithObject:(id)object;</span><br><span class="line">- (instancetype)initWithObject:(id)object;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">@interface ZOCWeakObject ()</span><br><span class="line">@property (nonatomic, weak) id object;</span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@implementation ZOCWeakObject</span><br><span class="line"></span><br><span class="line">+ (instancetype)weakObjectWithObject:(id)object &#123;</span><br><span class="line">    return [[[self class] alloc] initWithObject:object];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (instancetype)initWithObject:(id)object &#123;</span><br><span class="line">    if ((self = [super init])) &#123;</span><br><span class="line">        _object = object;</span><br><span class="line">    &#125;</span><br><span class="line">    return self;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (BOOL)isEqual:(id)object &#123;</span><br><span class="line">    if (self == object) &#123;</span><br><span class="line">        return YES;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if (![object isKindOfClass:[object class]]) &#123;</span><br><span class="line">        return NO;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return [self isEqualToWeakObject:(ZOCWeakObject *)object];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (BOOL)isEqualToWeakObject:(ZOCWeakObject *)object &#123;</span><br><span class="line">    if (!object) &#123;</span><br><span class="line">        return NO;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    BOOL objectsMatch = [self.object isEqual:object.object];</span><br><span class="line">    return objectsMatch;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (NSUInteger)hash &#123;</span><br><span class="line">    return [self.object hash];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<p>A simple component using weak objects to achieve multiple delegation:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">@protocol ZOCServiceDelegate &lt;NSObject&gt;</span><br><span class="line">@optional</span><br><span class="line">- (void)generalService:(ZOCGeneralService *)service didRetrieveEntries:(NSArray *)entries;</span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@interface ZOCGeneralService : NSObject</span><br><span class="line">- (void)registerDelegate:(id&lt;ZOCServiceDelegate&gt;)delegate;</span><br><span class="line">- (void)deregisterDelegate:(id&lt;ZOCServiceDelegate&gt;)delegate;</span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@interface ZOCGeneralService ()</span><br><span class="line">@property (nonatomic, strong) NSMutableSet *delegates;</span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">@implementation ZOCGeneralService</span><br><span class="line">- (void)registerDelegate:(id&lt;ZOCServiceDelegate&gt;)delegate &#123;</span><br><span class="line">    if ([delegate conformsToProtocol:@protocol(ZOCServiceDelegate)]) &#123;</span><br><span class="line">        [self.delegates addObject:[[ZOCWeakObject alloc] initWithObject:delegate]];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)deregisterDelegate:(id&lt;ZOCServiceDelegate&gt;)delegate &#123;</span><br><span class="line">    if ([delegate conformsToProtocol:@protocol(ZOCServiceDelegate)]) &#123;</span><br><span class="line">        [self.delegates removeObject:[[ZOCWeakObject alloc] initWithObject:delegate]];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)p_notifyDelegates &#123;</span><br><span class="line">    ...</span><br><span class="line">    for (ZOCWeakObject *object in self.delegates) &#123;</span><br><span class="line">        if (object.object) &#123;</span><br><span class="line">            if ([object.object respondsToSelector:@selector(generalService:didRetrieveEntries:)]) &#123;</span><br><span class="line">                [object.object generalService:self didRetrieveEntries:entries];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<p>With the <code>registerDelegate:</code> and <code>deregisterDelegate:</code> methods, it is easy to connect/disconnect cables between components: if at some point in time a delegate object is not interested in receiving the callbacks from a delegant, it has the chance to just ‘unsubscribe’.<br>This can be useful when there are different views waiting for some callback to update the shown info: if a view is temporarily hidden (but still alive) it could make sense for it to just unsubscribe to those callbacks.</p>
<h1 id="Aspect-Oriented-Programming"><a href="#Aspect-Oriented-Programming" class="headerlink" title="Aspect Oriented Programming"></a>Aspect Oriented Programming</h1><p>Aspect Oriented Programming (AOP) is something not well-known in the Objective-C community but it should be as the runtime is so powerful that AOP should be one of the first things that comes to the mind. Unfortunately, as there is no standard de facto library, nothing comes ready to use out-of-the-box from Apple and the topic is far from being trivial, developers still don’t think of it in nowadays. </p>
<p>Quoting the <a href="http://en.wikipedia.org/wiki/Aspect-oriented_programming" target="_blank" rel="noopener">Aspect Oriented Programming</a> Wikipedia page:</p>
<blockquote>
<p>An aspect can alter the behavior of the base code (the non-aspect part of a program) by applying advice (additional behavior) at various join points (points in a program) specified in a quantification or query called a pointcut (that detects whether a given join point matches).</p>
</blockquote>
<p>In the world of Objective-C this means using the runtime features to add <em>aspects</em> to specific methods. The additional behaviors given by the aspect can be either:</p>
<ul>
<li>add code to be performed before a specific method call on a specific class</li>
<li>add code to be performed after a specific method call on a specific class</li>
<li>add code to be performed instead of the original implementation of a specific method call on a specific class</li>
</ul>
<p>There are many ways to achieve this we are not digging into deep here, basically all of them leverage the power of the runtime.<br><a href="https://twitter.com/steipete" target="_blank" rel="noopener">Peter Steinberger</a> wrote a library, <a href="https://github.com/steipete/Aspects" target="_blank" rel="noopener">Aspects</a> that fits the AOP approach perfectly. We found it reliable and well-designed and we are going to use it here for sake of simplicity.<br>As said for all the AOP-ish libraries, the library does some cool magic with the runtime, replacing and adding methods (further tricks over the method swizzling technique).<br>The API of Aspect are interesting and powerful:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+ (id&lt;AspectToken&gt;)aspect_hookSelector:(SEL)selector</span><br><span class="line">                           withOptions:(AspectOptions)options</span><br><span class="line">                            usingBlock:(id)block</span><br><span class="line">                                 error:(NSError **)error;</span><br><span class="line">- (id&lt;AspectToken&gt;)aspect_hookSelector:(SEL)selector</span><br><span class="line">                           withOptions:(AspectOptions)options</span><br><span class="line">                            usingBlock:(id)block</span><br><span class="line">                                 error:(NSError **)error;</span><br></pre></td></tr></table></figure>
<p>For instance, the following code will perform the block parameter after the execution of the method <code>myMethod:</code> (instance or class method that be) on the class <code>MyClass</code>.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[MyClass aspect_hookSelector:@selector(myMethod:)</span><br><span class="line">                 withOptions:AspectPositionAfter</span><br><span class="line">                  usingBlock:^(id&lt;AspectInfo&gt; aspectInfo) &#123;</span><br><span class="line">            ...</span><br><span class="line">        &#125;</span><br><span class="line">                       error:nil];</span><br></pre></td></tr></table></figure>
<p>In other words: the code provided in the block parameter will always be executed after each call of the <code>@selector</code> parameter on any object of type <code>MyClass</code> (or on the class itself if the method is a class method).</p>
<p>We added an aspect on <code>MyClass</code> for the method <code>myMethod:</code>.</p>
<p>Usually AOP is used to implement cross cutting concern. Perfect example to leverage are analytics or logging.</p>
<p>In the following we will present the use of AOP for analytics. Analytics are a popular “feature” to include in iOS projects, with a huge variety of choices ranging from Google Analytics, Flurry, MixPanel, etc.<br>Most of them have tutorials describing how to track specific views and events including a few lines of code inside each class.</p>
<p>On Ray Wenderlich’s blog there is a long <a href="http://www.raywenderlich.com/53459/google-analytics-ios" target="_blank" rel="noopener">article</a> with some sample code to include in your view controller in order to track an event with <a href="https://developers.google.com/analytics/devguides/collection/ios/" target="_blank" rel="noopener">Google Analytics</a>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">- (void)logButtonPress:(UIButton *)button &#123;</span><br><span class="line">    id&lt;GAITracker&gt; tracker = [[GAI sharedInstance] defaultTracker];</span><br><span class="line">    [tracker send:[[GAIDictionaryBuilder createEventWithCategory:@&quot;UX&quot;</span><br><span class="line">                                                          action:@&quot;touch&quot;</span><br><span class="line">                                                           label:[button.titleLabel text]</span><br><span class="line">                                                           value:nil] build]];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>The code above sends an event with context information whenever a button is tapped. Things get worse when you want to track a screen view:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">- (void)viewDidAppear:(BOOL)animated &#123;</span><br><span class="line">    [super viewDidAppear:animated];</span><br><span class="line"></span><br><span class="line">    id&lt;GAITracker&gt; tracker = [[GAI sharedInstance] defaultTracker];</span><br><span class="line">    [tracker set:kGAIScreenName value:@&quot;Stopwatch&quot;];</span><br><span class="line">    [tracker send:[[GAIDictionaryBuilder createAppView] build]];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>This should look like a code smell to the most of the experienced iOS developers. We are actually making the view controller dirty adding lines of code that should not belong there as it’s not responsibility of the view controller to track events. You could argue that you usually have a specific object responsible for analytics tracking and you inject this object inside the view controller but the problem is still there and no matter where you hide the tracking logic: you eventually end up inserting some lines of code in the <code>viewDidAppear:</code>.</p>
<p>We can use AOP to track screen views on specific <code>viewDidAppear:</code> methods, and moreover, we could use the same approach to add event tracking in other methods we are interested in, for instance when the user taps on a button (i.e. trivially calling the corresponding IBAction).</p>
<p>This approach is clean and unobtrusive:</p>
<ul>
<li>the view controllers will not get dirty with code that does not naturally belongs to them</li>
<li>it becomes possible to specify a SPOC file (single point of customization) for all the aspects to add to our code</li>
<li>the SPOC should be used to add the aspects at the very startup of the app</li>
<li>if the SPOC file is malformed and at least one selector or class is not recognized, the app will crash at startup (which is cool for our purposes) </li>
<li>the team in the company responsible for managing the analytics usually provides a document with the list of <em>things</em> to track; this document could then be easily mapped to a SPOC file</li>
<li>as the logic for the tracking is now abstracted, it becomes possible to scale with a grater number of analytics providers</li>
<li>for screen views it is enough to specify in the SPOC file the classes involved (the corresponding aspect will be added to the <code>viewDidAppear:</code> method), for events it is necessary to specify the selectors. To send both screen views and events, a tracking label and maybe extra meta data are needed to provide extra information (depending on the analytics provider).</li>
</ul>
<p>We may want a SPOC file similar to the following (also a .plist file would perfectly fit as well):</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">NSDictionary *analyticsConfiguration() &#123;</span><br><span class="line">    return @&#123;</span><br><span class="line">        @&quot;trackedScreens&quot; : @[</span><br><span class="line">            @&#123;</span><br><span class="line">                @&quot;class&quot; : @&quot;ZOCMainViewController&quot;,</span><br><span class="line">                @&quot;label&quot; : @&quot;Main screen&quot;</span><br><span class="line">                &#125;</span><br><span class="line">             ],</span><br><span class="line">        @&quot;trackedEvents&quot; : @[</span><br><span class="line">            @&#123;</span><br><span class="line">                @&quot;class&quot; : @&quot;ZOCMainViewController&quot;,</span><br><span class="line">                @&quot;selector&quot; : @&quot;loginViewFetchedUserInfo:user:&quot;,</span><br><span class="line">                @&quot;label&quot; : @&quot;Login with Facebook&quot;</span><br><span class="line">                &#125;,</span><br><span class="line">            @&#123;</span><br><span class="line">                @&quot;class&quot; : @&quot;ZOCMainViewController&quot;,</span><br><span class="line">                @&quot;selector&quot; : @&quot;loginViewShowingLoggedOutUser:&quot;,</span><br><span class="line">                @&quot;label&quot; : @&quot;Logout with Facebook&quot;</span><br><span class="line">                &#125;,</span><br><span class="line">            @&#123;</span><br><span class="line">                @&quot;class&quot; : @&quot;ZOCMainViewController&quot;,</span><br><span class="line">                @&quot;selector&quot; : @&quot;loginView:handleError:&quot;,</span><br><span class="line">                @&quot;label&quot; : @&quot;Login error with Facebook&quot;</span><br><span class="line">                &#125;,</span><br><span class="line">            @&#123;</span><br><span class="line">                @&quot;class&quot; : @&quot;ZOCMainViewController&quot;,</span><br><span class="line">                @&quot;selector&quot; : @&quot;shareButtonPressed:&quot;,</span><br><span class="line">                @&quot;label&quot; : @&quot;Share button&quot;</span><br><span class="line">                &#125;</span><br><span class="line">             ]</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>The architecture proposed is hosted on GitHub on the <a href="https://github.com/ef-ctx/JohnnyEnglish/blob/master/CTXUserActivityTrackingManager.m" target="_blank" rel="noopener">EF Education First</a> profile.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">- (void)setupWithConfiguration:(NSDictionary *)configuration &#123;</span><br><span class="line">    // screen views tracking</span><br><span class="line">    for (NSDictionary *trackedScreen in configuration[@&quot;trackedScreens&quot;]) &#123;</span><br><span class="line">        Class clazz = NSClassFromString(trackedScreen[@&quot;class&quot;]);</span><br><span class="line"></span><br><span class="line">        [clazz aspect_hookSelector:@selector(viewDidAppear:)</span><br><span class="line">                       withOptions:AspectPositionAfter</span><br><span class="line">                        usingBlock:^(id&lt;AspectInfo&gt; aspectInfo) &#123;</span><br><span class="line">            dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^&#123;</span><br><span class="line">                NSString *viewName = trackedScreen[@&quot;label&quot;];</span><br><span class="line">                [tracker trackScreenHitWithName:viewName];</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;];</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // events tracking</span><br><span class="line">    for (NSDictionary *trackedEvents in configuration[@&quot;trackedEvents&quot;]) &#123;</span><br><span class="line">        Class clazz = NSClassFromString(trackedEvents[@&quot;class&quot;]);</span><br><span class="line">        SEL selektor = NSSelectorFromString(trackedEvents[@&quot;selector&quot;]);</span><br><span class="line"></span><br><span class="line">        [clazz aspect_hookSelector:selektor</span><br><span class="line">                       withOptions:AspectPositionAfter</span><br><span class="line">                        usingBlock:^(id&lt;AspectInfo&gt; aspectInfo) &#123;</span><br><span class="line">            dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^&#123;</span><br><span class="line">                UserActivityButtonPressedEvent *buttonPressEvent = [UserActivityButtonPressedEvent eventWithLabel:trackedEvents[@&quot;label&quot;]];</span><br><span class="line">                [tracker trackEvent:buttonPressEvent];</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;];</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="References-1"><a href="#References-1" class="headerlink" title="References"></a>References</h1><p>Here are some of the documents from Apple that informed the style guide:</p>
<ul>
<li><a href="http://developer.apple.com/library/mac/#documentation/Cocoa/Conceptual/ObjectiveC/Introduction/introObjectiveC.html" target="_blank" rel="noopener">The Objective-C Programming Language</a></li>
<li><a href="https://developer.apple.com/library/mac/#documentation/Cocoa/Conceptual/CocoaFundamentals/Introduction/Introduction.html" target="_blank" rel="noopener">Cocoa Fundamentals Guide</a></li>
<li><a href="https://developer.apple.com/library/mac/#documentation/Cocoa/Conceptual/CodingGuidelines/CodingGuidelines.html" target="_blank" rel="noopener">Coding Guidelines for Cocoa</a></li>
<li><a href="http://developer.apple.com/library/ios/#documentation/iphone/conceptual/iphoneosprogrammingguide/Introduction/Introduction.html" target="_blank" rel="noopener">iOS App Programming Guide</a></li>
<li><a href="https://developer.apple.com/library/ios/documentation/cocoa/conceptual/ProgrammingWithObjectiveC/Conventions/Conventions.html" target="_blank" rel="noopener">Apple Objective-C conventions</a>: code conventions from Apple;</li>
</ul>
<p>Others:</p>
<ul>
<li><a href="http://objclean.com" target="_blank" rel="noopener">Objective-Clean</a>: an attempt to write a standard for writing Objective-C code with Xcode integration;</li>
<li><a href="http://uncrustify.sourceforge.net/" target="_blank" rel="noopener">Uncrustify</a>: source code beautifier.</li>
</ul>
<h3 id="Other-Objective-C-Style-Guides"><a href="#Other-Objective-C-Style-Guides" class="headerlink" title="Other Objective-C Style Guides"></a>Other Objective-C Style Guides</h3><p>Here are some of the documents from Apple that informed the style guide. If something has not been mentioned in this book, it’s probably covered in great detail in one of these:</p>
<p>From Apple:</p>
<ul>
<li><a href="http://developer.apple.com/library/mac/#documentation/Cocoa/Conceptual/ObjectiveC/Introduction/introObjectiveC.html" target="_blank" rel="noopener">The Objective-C Programming Language</a></li>
<li><a href="https://developer.apple.com/library/mac/#documentation/Cocoa/Conceptual/CocoaFundamentals/Introduction/Introduction.html" target="_blank" rel="noopener">Cocoa Fundamentals Guide</a></li>
<li><a href="https://developer.apple.com/library/mac/#documentation/Cocoa/Conceptual/CodingGuidelines/CodingGuidelines.html" target="_blank" rel="noopener">Coding Guidelines for Cocoa</a></li>
<li><a href="http://developer.apple.com/library/ios/#documentation/iphone/conceptual/iphoneosprogrammingguide/Introduction/Introduction.html" target="_blank" rel="noopener">iOS App Programming Guide</a></li>
</ul>
<p>From the community:</p>
<ul>
<li><a href="https://github.com/NYTimes/objetive-c-style-guide" target="_blank" rel="noopener">NYTimes Objective-C Style Guide</a></li>
<li><a href="http://google-styleguide.googlecode.com/svn/trunk/objcguide.xml" target="_blank" rel="noopener">Google</a></li>
<li><a href="https://github.com/github/objective-c-conventions" target="_blank" rel="noopener">GitHub</a></li>
<li><a href="https://trac.adium.im/wiki/CodingStyle" target="_blank" rel="noopener">Adium</a></li>
<li><a href="https://gist.github.com/soffes/812796" target="_blank" rel="noopener">Sam Soffes</a></li>
<li><a href="http://cocoadevcentral.com/articles/000082.php" target="_blank" rel="noopener">CocoaDevCentral</a></li>
<li><a href="http://lukeredpath.co.uk/blog/my-objective-c-style-guide.html" target="_blank" rel="noopener">Luke Redpath</a></li>
<li><a href="http://www.cimgf.com/zds-code-style-guide/" target="_blank" rel="noopener">Marcus Zarra</a></li>
<li><a href="https://github.com/raywenderlich/objective-c-style-guide" target="_blank" rel="noopener">Ray Wenderlich</a></li>
</ul>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/《禅与Objective-C编程艺术》/" rel="tag"># 《禅与Objective-C编程艺术》</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/11/13/禅与Objective-C编程艺术中文版/" rel="next" title="禅与Objective-C编程艺术中文版">
                <i class="fa fa-chevron-left"></i> 禅与Objective-C编程艺术中文版
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2018/11/13/禅与Objective-C编程艺术/" rel="prev" title="禅与Objective-C编程艺术">
                禅与Objective-C编程艺术 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/avatar.jpg" alt="张康">
            
              <p class="site-author-name" itemprop="name">张康</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">6</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">4</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">5</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Zen-and-the-Art-of-the-Objective-C-Craftsmanship"><span class="nav-number">1.</span> <span class="nav-text">Zen and the Art of the Objective-C Craftsmanship</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Preface"><span class="nav-number">2.</span> <span class="nav-text">Preface</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Swift"><span class="nav-number">2.1.</span> <span class="nav-text">Swift</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#For-the-Community"><span class="nav-number">2.2.</span> <span class="nav-text">For the Community</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Authors"><span class="nav-number">2.3.</span> <span class="nav-text">Authors</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Conditionals"><span class="nav-number">3.</span> <span class="nav-text">Conditionals</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Yoda-conditions"><span class="nav-number">3.1.</span> <span class="nav-text">Yoda conditions</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#nil-and-BOOL-checks"><span class="nav-number">3.2.</span> <span class="nav-text">nil and BOOL checks</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Golden-Path"><span class="nav-number">3.3.</span> <span class="nav-text">Golden Path</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Complex-Conditions"><span class="nav-number">3.4.</span> <span class="nav-text">Complex Conditions</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Ternary-Operator"><span class="nav-number">3.5.</span> <span class="nav-text">Ternary Operator</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Error-handling"><span class="nav-number">3.6.</span> <span class="nav-text">Error handling</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Case-Statements"><span class="nav-number">4.</span> <span class="nav-text">Case Statements</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Enumerated-Types"><span class="nav-number">4.0.1.</span> <span class="nav-text">Enumerated Types</span></a></li></ol></li></ol><li class="nav-item nav-level-1"><a class="nav-link" href="#Naming"><span class="nav-number">5.</span> <span class="nav-text">Naming</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#General-conventions"><span class="nav-number">5.1.</span> <span class="nav-text">General conventions</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Constants"><span class="nav-number">5.2.</span> <span class="nav-text">Constants</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Methods"><span class="nav-number">5.3.</span> <span class="nav-text">Methods</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Literals"><span class="nav-number">5.4.</span> <span class="nav-text">Literals</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Class"><span class="nav-number">6.</span> <span class="nav-text">Class</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Class-name"><span class="nav-number">6.1.</span> <span class="nav-text">Class name</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Initializer-and-dealloc"><span class="nav-number">6.2.</span> <span class="nav-text">Initializer and dealloc</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Designated-and-Secondary-Initializers"><span class="nav-number">6.2.1.</span> <span class="nav-text">Designated and Secondary Initializers</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Designated-Initializer"><span class="nav-number">6.2.1.1.</span> <span class="nav-text">Designated Initializer</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Secondary-Initializer"><span class="nav-number">6.2.1.2.</span> <span class="nav-text">Secondary Initializer</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#References"><span class="nav-number">6.2.1.2.1.</span> <span class="nav-text">References</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#instancetype"><span class="nav-number">6.2.2.</span> <span class="nav-text">instancetype</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Reference"><span class="nav-number">6.2.2.0.1.</span> <span class="nav-text">Reference</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Initialization-Patterns"><span class="nav-number">6.2.3.</span> <span class="nav-text">Initialization Patterns</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Class-cluster"><span class="nav-number">6.2.3.1.</span> <span class="nav-text">Class cluster</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Singleton"><span class="nav-number">6.2.3.2.</span> <span class="nav-text">Singleton</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Properties"><span class="nav-number">6.3.</span> <span class="nav-text">Properties</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Init-and-Dealloc"><span class="nav-number">6.3.0.1.</span> <span class="nav-text">Init and Dealloc</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Dot-Notation"><span class="nav-number">6.3.0.2.</span> <span class="nav-text">Dot-Notation</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Property-Declaration"><span class="nav-number">6.3.1.</span> <span class="nav-text">Property Declaration</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Private-Properties"><span class="nav-number">6.3.1.1.</span> <span class="nav-text">Private Properties</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Mutable-Object"><span class="nav-number">6.3.2.</span> <span class="nav-text">Mutable Object</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Lazy-Loading"><span class="nav-number">6.3.3.</span> <span class="nav-text">Lazy Loading</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Methods-1"><span class="nav-number">6.4.</span> <span class="nav-text">Methods</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Parameter-Assert"><span class="nav-number">6.4.1.</span> <span class="nav-text">Parameter Assert</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Private-methods"><span class="nav-number">6.4.2.</span> <span class="nav-text">Private methods</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Equality"><span class="nav-number">6.5.</span> <span class="nav-text">Equality</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Categories"><span class="nav-number">7.</span> <span class="nav-text">Categories</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Protocols"><span class="nav-number">8.</span> <span class="nav-text">Protocols</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#NSNotification"><span class="nav-number">9.</span> <span class="nav-text">NSNotification</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Beautifying-the-code"><span class="nav-number">10.</span> <span class="nav-text">Beautifying the code</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Spacing"><span class="nav-number">10.0.1.</span> <span class="nav-text">Spacing</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Line-Breaks"><span class="nav-number">10.0.2.</span> <span class="nav-text">Line Breaks</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Brackets"><span class="nav-number">10.0.3.</span> <span class="nav-text">Brackets</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Code-Organization"><span class="nav-number">11.</span> <span class="nav-text">Code Organization</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Exploit-Code-Block"><span class="nav-number">11.1.</span> <span class="nav-text">Exploit Code Block</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Pragma"><span class="nav-number">11.2.</span> <span class="nav-text">Pragma</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Pragma-Mark"><span class="nav-number">11.2.1.</span> <span class="nav-text">Pragma Mark</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Notes-about-pragma"><span class="nav-number">11.2.2.</span> <span class="nav-text">Notes about pragma</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Explicit-warnings-and-errors"><span class="nav-number">11.3.</span> <span class="nav-text">Explicit warnings and errors</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Docstrings"><span class="nav-number">11.4.</span> <span class="nav-text">Docstrings</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Comments"><span class="nav-number">11.5.</span> <span class="nav-text">Comments</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Header-Documentation"><span class="nav-number">11.5.1.</span> <span class="nav-text">Header Documentation</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Inter-Object-Communication"><span class="nav-number">12.</span> <span class="nav-text">Inter-Object Communication</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Blocks"><span class="nav-number">12.1.</span> <span class="nav-text">Blocks</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Under-the-Hood"><span class="nav-number">12.1.1.</span> <span class="nav-text">Under the Hood</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Retain-cycles-on-self"><span class="nav-number">12.1.2.</span> <span class="nav-text">Retain cycles on self</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Delegate-and-DataSource"><span class="nav-number">12.2.</span> <span class="nav-text">Delegate and DataSource</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Inheritance"><span class="nav-number">12.2.1.</span> <span class="nav-text">Inheritance</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Multiple-Delegation"><span class="nav-number">12.2.2.</span> <span class="nav-text">Multiple Delegation</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Aspect-Oriented-Programming"><span class="nav-number">13.</span> <span class="nav-text">Aspect Oriented Programming</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#References-1"><span class="nav-number">14.</span> <span class="nav-text">References</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Other-Objective-C-Style-Guides"><span class="nav-number">14.0.1.</span> <span class="nav-text">Other Objective-C Style Guides</span></a></li></ol></li></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">张康</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
